import{r as b,j as t,L as ne,m as v,n as I,o as F,p as z,q as j,h as X,e as ae,u as q}from"./index-BqTI3VMm.js";const oe=function(){const N=b.useRef(null),M=b.useRef(),k=b.useRef({maxSteps:64,maxDistance:20,surfaceDistance:.01,camera:{position:{x:0,y:0,z:-3},target:{x:0,y:0,z:0},fov:Math.PI/4},time:0,lightPosition:{x:2,y:2,z:-1}}),[S,B]=b.useState(!1),[P,H]=b.useState("normal"),[C,J]=b.useState("sphere"),[A,K]=b.useState(!1),E=(e,s)=>q(e)-s,O=(e,s)=>{const n={x:Math.abs(e.x)-s.x,y:Math.abs(e.y)-s.y,z:Math.abs(e.z)-s.z};return q({x:Math.max(n.x,0),y:Math.max(n.y,0),z:Math.max(n.z,0)})+Math.min(Math.max(n.x,Math.max(n.y,n.z)),0)},Q=(e,s,n)=>{const a={x:Math.sqrt(e.x*e.x+e.z*e.z)-s,y:e.y};return Math.sqrt(a.x*a.x+a.y*a.y)-n},U=(e,s=8)=>{let n={...e},a=1,r=0;for(let i=0;i<4&&(r=q(n),!(r>2));i++){const l=Math.acos(n.z/r),u=Math.atan2(n.y,n.x);a=Math.pow(r,s-1)*s*a+1;const y=Math.pow(r,s),o=l*s,h=u*s;n=z(j({x:Math.sin(o)*Math.cos(h),y:Math.sin(h)*Math.sin(o),z:Math.cos(o)},y),e)}return .5*Math.log(r)*r/a},p=(e,s)=>{const n=s*.5,a={x:e.x*Math.cos(n)-e.z*Math.sin(n),y:e.y,z:e.x*Math.sin(n)+e.z*Math.cos(n)};switch(C){case"sphere":return E(a,1);case"box":return O(a,{x:.8,y:.8,z:.8});case"torus":return Q(a,1,.3);case"mandelbulb":return U(j(a,.5))*2;default:return E(a,1)}},V=(e,s)=>{const a={x:p({x:e.x+.01,y:e.y,z:e.z},s)-p({x:e.x-.01,y:e.y,z:e.z},s),y:p({x:e.x,y:e.y+.01,z:e.z},s)-p({x:e.x,y:e.y-.01,z:e.z},s),z:p({x:e.x,y:e.y,z:e.z+.01},s)-p({x:e.x,y:e.y,z:e.z-.01},s)};return v(a)},Z=(e,s,n)=>{let a=0,r=0;for(let i=0;i<n.maxSteps;i++){const l=z(e,j(s,a)),u=p(l,n.time);if(a+=u,r=i,u<n.surfaceDistance)return{distance:a,steps:r,hit:!0};if(a>n.maxDistance)break}return{distance:a,steps:r,hit:!1}},D=()=>{const e=N.current,s=e==null?void 0:e.getContext("2d");if(!e||!s)return;const{width:n,height:a}=e,r=s.createImageData(n,a),i=r.data,l=k.current,u=n/a,y=l.camera,o=v(I(y.target,y.position)),h=v(F(o,{x:0,y:1,z:0})>.99?{x:1,y:0,z:0}:v({x:o.z,y:0,z:-o.x})),te=v(I({x:0,y:0,z:0},F(h,o)>0?{x:h.y*o.z-h.z*o.y,y:h.z*o.x-h.x*o.z,z:h.x*o.y-h.y*o.x}:{x:0,y:1,z:0})),L=Math.tan(y.fov*.5);for(let m=0;m<a;m+=2)for(let c=0;c<n;c+=2){const Y={x:(2*c/n-1)*u*L,y:(1-2*m/a)*L},G=v(z(z(o,j(h,Y.x)),j(te,Y.y))),w=Z(y.position,G,l);let f={r:0,g:0,b:0};if(w.hit){const d=z(y.position,j(G,w.distance));switch(P){case"normal":{const x=V(d,l.time),g=v(I(l.lightPosition,d)),R=Math.max(0,F(x,g)),se=((d.x+d.y+d.z)*50+l.time*20)%360,T=X(se,70,50);f={r:T.r*R,g:T.g*R,b:T.b*R};break}case"depth":{const x=1-ae(w.distance/l.maxDistance,0,1);f={r:x*255,g:x*255,b:x*255};break}case"steps":{const g=(1-w.steps/l.maxSteps)*240;f=X(g,100,50);break}}}else{const d=m/a*.3;f={r:d*50,g:d*70,b:d*100}}for(let d=0;d<2&&m+d<a;d++)for(let x=0;x<2&&c+x<n;x++){const g=((m+d)*n+(c+x))*4;i[g]=Math.min(255,Math.max(0,f.r)),i[g+1]=Math.min(255,Math.max(0,f.g)),i[g+2]=Math.min(255,Math.max(0,f.b)),i[g+3]=255}}if(s.putImageData(r,0,0),A){s.strokeStyle="rgba(255, 255, 255, 0.3)",s.lineWidth=1;const m=20;for(let c=0;c<=n;c+=m)s.beginPath(),s.moveTo(c,0),s.lineTo(c,a),s.stroke();for(let c=0;c<=a;c+=m)s.beginPath(),s.moveTo(0,c),s.lineTo(n,c),s.stroke()}},W=()=>{S&&(k.current.time+=.02,D(),M.current=requestAnimationFrame(W))},_=()=>{B(!0),M.current=requestAnimationFrame(W)},$=()=>{B(!1),M.current&&cancelAnimationFrame(M.current)},ee=e=>{if(!e.buttons)return;const s=N.current;if(!s)return;const n=s.getBoundingClientRect(),a=(e.clientX-n.left)/n.width,r=(e.clientY-n.top)/n.height,i=3,l=(a-.5)*Math.PI*2,u=(r-.5)*Math.PI;k.current.camera.position={x:Math.sin(l)*Math.cos(u)*i,y:Math.sin(u)*i,z:Math.cos(l)*Math.cos(u)*i},S||D()};return b.useEffect(()=>{const e=N.current;if(e)return e.width=400,e.height=300,D(),()=>{M.current&&cancelAnimationFrame(M.current)}},[P,C,A]),t.jsxs("div",{className:"container mx-auto px-4 py-8",children:[t.jsxs("div",{className:"mb-8",children:[t.jsx("h1",{className:"text-3xl font-bold mb-4",children:"Advanced Ray Marching 3D Renderer"}),t.jsx("p",{className:"text-gray-600 mb-4",children:"Signed distance fields with multiple primitives, debug visualization, and interactive camera controls."}),t.jsx("div",{className:"bg-purple-50 border border-purple-200 rounded-lg p-4",children:t.jsx("p",{className:"text-purple-800",children:"üîÆ Drag to rotate camera, explore different primitives and rendering modes"})})]}),t.jsxs("div",{className:"mb-6",children:[t.jsxs("div",{className:"flex flex-wrap gap-4 mb-4",children:[t.jsx("button",{type:"button",onClick:_,disabled:S,className:"px-4 py-2 bg-purple-600 text-white rounded-md hover:bg-purple-700 disabled:opacity-50 transition-colors",children:"Start Animation"}),t.jsx("button",{type:"button",onClick:$,disabled:!S,className:"px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 disabled:opacity-50 transition-colors",children:"Stop Animation"}),t.jsx("button",{type:"button",onClick:D,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors",children:"Render Frame"})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Primitive Type"}),t.jsxs("select",{value:C,onChange:e=>J(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500",children:[t.jsx("option",{value:"sphere",children:"Sphere"}),t.jsx("option",{value:"box",children:"Box"}),t.jsx("option",{value:"torus",children:"Torus"}),t.jsx("option",{value:"mandelbulb",children:"Mandelbulb"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Render Mode"}),t.jsxs("select",{value:P,onChange:e=>H(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500",children:[t.jsx("option",{value:"normal",children:"Normal Shading"}),t.jsx("option",{value:"depth",children:"Depth Buffer"}),t.jsx("option",{value:"steps",children:"Ray Steps"})]})]}),t.jsx("div",{className:"flex items-center",children:t.jsxs("label",{className:"flex items-center",children:[t.jsx("input",{type:"checkbox",checked:A,onChange:e=>K(e.target.checked),className:"mr-2"}),t.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Show Wireframe"})]})})]})]}),t.jsx("div",{className:"mb-6",children:t.jsx("canvas",{ref:N,className:"border border-gray-300 rounded-lg bg-black cursor-move",style:{maxWidth:"100%",height:"auto"},onMouseMove:ee})}),t.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[t.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:[t.jsx("h3",{className:"text-lg font-semibold mb-2 text-yellow-800",children:"Ray Marching Technique"}),t.jsxs("ul",{className:"text-yellow-700 space-y-1",children:[t.jsxs("li",{children:["‚Ä¢ ",t.jsx("strong",{children:"Distance Fields"}),": Mathematical functions describing 3D shapes"]}),t.jsxs("li",{children:["‚Ä¢ ",t.jsx("strong",{children:"Ray Stepping"}),": March along rays using safe distance steps"]}),t.jsxs("li",{children:["‚Ä¢ ",t.jsx("strong",{children:"Surface Detection"}),": Find intersections without triangle meshes"]}),t.jsxs("li",{children:["‚Ä¢ ",t.jsx("strong",{children:"Gradient Normals"}),": Calculate surface normals from SDF gradients"]})]})]}),t.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[t.jsx("h3",{className:"text-lg font-semibold mb-2 text-blue-800",children:"Rendering Features"}),t.jsxs("ul",{className:"text-blue-700 space-y-1",children:[t.jsxs("li",{children:["‚Ä¢ ",t.jsx("strong",{children:"Multiple Primitives"}),": Sphere, box, torus, and Mandelbulb"]}),t.jsxs("li",{children:["‚Ä¢ ",t.jsx("strong",{children:"Real-time Rotation"}),": Interactive camera controls"]}),t.jsxs("li",{children:["‚Ä¢ ",t.jsx("strong",{children:"Debug Modes"}),": Depth buffer and ray step visualization"]}),t.jsxs("li",{children:["‚Ä¢ ",t.jsx("strong",{children:"Dynamic Lighting"}),": Diffuse shading with moving light source"]})]})]})]}),t.jsx("div",{className:"mt-6",children:t.jsx(ne,{to:"/examples/visual",className:"inline-block px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors",children:"‚Üê Back to Examples"})})]})};export{oe as component};
