import{r as u,j as e,L as oe,l as D,T as M,P as Q,k as B,s as _,e as ie}from"./index-BqTI3VMm.js";const ce=function(){const I=u.useRef(null),[d,G]=u.useState([{id:"gen1",name:"Generator 1",type:"slack",voltage:1.05,angle:0,realPower:0,reactivePower:0,x:100,y:100,voltageSpec:1.05,generation:300},{id:"gen2",name:"Generator 2",type:"pv",voltage:1.02,angle:0,realPower:150,reactivePower:0,x:500,y:100,voltageSpec:1.02,generation:250},{id:"load1",name:"Load Center 1",type:"pq",voltage:1,angle:0,realPower:-120,reactivePower:-50,x:200,y:250,voltageSpec:0,generation:0},{id:"load2",name:"Load Center 2",type:"pq",voltage:1,angle:0,realPower:-80,reactivePower:-40,x:400,y:250,voltageSpec:0,generation:0},{id:"sub1",name:"Substation 1",type:"pq",voltage:1,angle:0,realPower:-60,reactivePower:-30,x:300,y:150,voltageSpec:0,generation:0}]),[F,U]=u.useState([{id:"line1",fromBus:"gen1",toBus:"sub1",resistance:.02,reactance:.06,susceptance:.03,rating:200,current:0,powerFlow:0,loading:0,losses:0},{id:"line2",fromBus:"gen2",toBus:"sub1",resistance:.03,reactance:.08,susceptance:.04,rating:150,current:0,powerFlow:0,loading:0,losses:0},{id:"line3",fromBus:"sub1",toBus:"load1",resistance:.01,reactance:.04,susceptance:.02,rating:100,current:0,powerFlow:0,loading:0,losses:0},{id:"line4",fromBus:"sub1",toBus:"load2",resistance:.02,reactance:.05,susceptance:.025,rating:120,current:0,powerFlow:0,loading:0,losses:0},{id:"line5",fromBus:"load1",toBus:"load2",resistance:.015,reactance:.045,susceptance:.02,rating:80,current:0,powerFlow:0,loading:0,losses:0}]),[m,k]=u.useState({baseVoltage:138,basePower:100,tolerance:.001,maxIterations:50,accelerationFactor:1.4,contingencyAnalysis:!1,displayMode:"voltage"}),[p,C]=u.useState({showVoltages:!0,showPowerFlows:!0,showCurrents:!1,showLosses:!1,showAngles:!1,animatePowerFlow:!0,showStability:!0,colorCodeVoltage:!0}),[r,X]=u.useState(null),[q,H]=u.useState(0),[L,O]=u.useState(!1),J=()=>{const s=d.length,t=m.tolerance,l=m.maxIterations,i=d.map(a=>a.voltage),c=d.map(a=>a.angle*Q/180),j=d.map(a=>a.realPower/100),v=d.map(a=>a.reactivePower/100),h=Array(s).fill(null).map(()=>Array(s).fill(0).map(()=>({real:0,imag:0})));F.forEach(a=>{const n=d.findIndex(b=>b.id===a.fromBus),g=d.findIndex(b=>b.id===a.toBus);if(n===-1||g===-1)return;const f={real:a.resistance,imag:a.reactance},o=f.real*f.real+f.imag*f.imag,x={real:f.real/o,imag:-f.imag/o};h[n][g].real-=x.real,h[n][g].imag-=x.imag,h[g][n].real-=x.real,h[g][n].imag-=x.imag,h[n][n].real+=x.real,h[n][n].imag+=x.imag+a.susceptance/2,h[g][g].real+=x.real,h[g][g].imag+=x.imag+a.susceptance/2});let N=!1,y=0,P=Number.POSITIVE_INFINITY;for(;!N&&y<l;){y++;const a=Array(s).fill(0),n=Array(s).fill(0);for(let o=0;o<s;o++)for(let x=0;x<s;x++){const b=h[o][x].real,V=h[o][x].imag,w=c[o]-c[x];a[o]+=i[o]*i[x]*(b*B(w)+V*_(w)),n[o]+=i[o]*i[x]*(b*_(w)-V*B(w))}const g=Array(s).fill(0),f=Array(s).fill(0);for(let o=0;o<s;o++)d[o].type!=="slack"&&(g[o]=j[o]-a[o]),d[o].type==="pq"&&(f[o]=v[o]-n[o]);if(P=Math.max(Math.max(...g.map(Math.abs)),Math.max(...f.map(Math.abs))),P<t){N=!0;break}for(let o=1;o<s;o++)d[o].type==="pq"?(c[o]+=g[o]*.1*m.accelerationFactor,i[o]+=f[o]*.05*m.accelerationFactor,i[o]=ie(i[o],.9,1.1)):d[o].type==="pv"&&(c[o]+=g[o]*.1*m.accelerationFactor)}const S=d.map((a,n)=>({...a,voltage:i[n],angle:c[n]*180/Q}));G(S);const A=F.map(a=>{const n=d.findIndex(W=>W.id===a.fromBus),g=d.findIndex(W=>W.id===a.toBus);if(n===-1||g===-1)return a;const f=i[n],o=i[g],x=c[n],b=c[g],V=Math.sqrt(a.resistance*a.resistance+a.reactance*a.reactance),w=Math.abs(f-o*B(x-b))/V,se=f*w*B(x-Math.atan2(a.reactance,a.resistance))*m.basePower,le=w*m.baseVoltage*Math.sqrt(3)/(a.rating*1e3)*100,ae=w*w*a.resistance*m.basePower;return{...a,current:w,powerFlow:se,loading:le,losses:ae}});U(A);const Z=S.filter(a=>a.type==="slack"||a.type==="pv").reduce((a,n)=>a+Math.max(0,n.realPower),0),ee=S.filter(a=>a.realPower<0).reduce((a,n)=>a+Math.abs(n.realPower),0),te=A.reduce((a,n)=>a+n.losses,0),Y=i.filter((a,n)=>d[n].type!=="slack"),E=Math.min(...Y),R=Math.max(...Y);let $="stable";return E<.95||R>1.05||P>.1?$="unstable":(E<.98||R>1.02)&&($="marginal"),{converged:N,iterations:y,maxMismatch:P,totalGeneration:Z,totalLoad:ee,totalLosses:te,minVoltage:E,maxVoltage:R,systemStability:$}},K=()=>{const s=I.current,t=s==null?void 0:s.getContext("2d");if(!(!s||!t)){if(t.clearRect(0,0,s.width,s.height),F.forEach(l=>{const i=d.find(y=>y.id===l.fromBus),c=d.find(y=>y.id===l.toBus);if(!i||!c)return;let j="#374151";p.colorCodeVoltage&&(l.loading>80?j="#dc2626":l.loading>60?j="#f59e0b":j="#10b981");const v=Math.max(2,l.rating/50);if(t.strokeStyle=j,t.lineWidth=v,t.beginPath(),t.moveTo(i.x,i.y),t.lineTo(c.x,c.y),t.stroke(),p.animatePowerFlow&&l.powerFlow>0){const y=q*.02%1,P=l.powerFlow>0?y:1-y,S=D(i.x,c.x,P),A=D(i.y,c.y,P);t.fillStyle="rgba(59, 130, 246, 0.8)",t.beginPath(),t.arc(S,A,4,0,M),t.fill()}const h=(i.x+c.x)/2,N=(i.y+c.y)/2;if(t.fillStyle="#1f2937",t.font="11px Arial",t.textAlign="center",p.showPowerFlows&&t.fillText(`${Math.abs(l.powerFlow).toFixed(1)} MW`,h,N-10),p.showCurrents&&t.fillText(`${(l.current*m.baseVoltage*Math.sqrt(3)/1e3).toFixed(1)} kA`,h,N+5),l.loading>0){const y=l.loading>80?"#dc2626":l.loading>60?"#f59e0b":"#10b981";t.fillStyle=y,t.fillText(`${l.loading.toFixed(0)}%`,h,N+20)}}),d.forEach(l=>{let i="#e5e7eb",c="#374151";if(l.type==="slack")i="#dbeafe",c="#1e40af";else if(l.type==="pv")i="#dcfce7",c="#15803d";else if(p.colorCodeVoltage){const v=Math.abs(l.voltage-1);v>.05?(i="#fecaca",c="#dc2626"):v>.02?(i="#fed7aa",c="#ea580c"):(i="#d1fae5",c="#059669")}t.fillStyle=i,t.strokeStyle=c,t.lineWidth=2;const j=l.generation>0?25:20;if(t.beginPath(),t.arc(l.x,l.y,j,0,M),t.fill(),t.stroke(),t.fillStyle="#1f2937",t.font="bold 12px Arial",t.textAlign="center",t.fillText(l.name,l.x,l.y-35),p.showVoltages&&(t.font="11px Arial",t.fillText(`${l.voltage.toFixed(3)} pu`,l.x,l.y+40),p.showAngles&&t.fillText(`${l.angle.toFixed(1)}°`,l.x,l.y+55)),l.realPower!==0){t.font="10px Arial";const v=l.realPower>0?`+${l.realPower.toFixed(0)} MW`:`${l.realPower.toFixed(0)} MW`;if(t.fillText(v,l.x,l.y-5),l.reactivePower!==0){const h=l.reactivePower>0?`+${l.reactivePower.toFixed(0)} MVAr`:`${l.reactivePower.toFixed(0)} MVAr`;t.fillText(h,l.x,l.y+8)}}l.generation>0&&(t.strokeStyle="#374151",t.lineWidth=2,t.beginPath(),t.arc(l.x,l.y,15,0,M),t.stroke(),t.fillStyle="#374151",t.font="bold 14px Arial",t.fillText("G",l.x,l.y+5))}),r&&p.showStability){const l=r.systemStability==="stable"?"#10b981":r.systemStability==="marginal"?"#f59e0b":"#dc2626";t.fillStyle=l,t.strokeStyle=l,t.lineWidth=2,t.beginPath(),t.arc(s.width-30,30,12,0,M),t.fill(),t.fillStyle="#1f2937",t.font="12px Arial",t.textAlign="right",t.fillText(`System: ${r.systemStability.toUpperCase()}`,s.width-50,35)}t.fillStyle="#1f2937",t.font="12px Arial",t.textAlign="left",t.fillText("Power System Load Flow Analysis",20,30),p.colorCodeVoltage&&(t.font="10px Arial",t.fillText("Bus Colors: Normal (Green), Marginal (Orange), Violation (Red)",20,50),t.fillText("Line Colors: Normal (Green), High Load (Yellow), Overload (Red)",20,65))}},z=async()=>{O(!0),await new Promise(t=>setTimeout(t,1e3));const s=J();X(s),O(!1)};u.useEffect(()=>{const s=I.current;s&&(s.width=700,s.height=400)},[]),u.useEffect(()=>{K()},[d,F,p,q,r]),u.useEffect(()=>{if(!p.animatePowerFlow)return;const s=setInterval(()=>{H(t=>t+1)},50);return()=>clearInterval(s)},[p.animatePowerFlow]),u.useEffect(()=>{z()},[d,m]);const T=(s,t,l)=>{G(i=>i.map(c=>c.id===s?{...c,[t]:l}:c))};return e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold mb-4",children:"Electrical Load Flow Analysis"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Power system analysis tool for voltage regulation, power flow calculation, and system stability assessment."}),e.jsx("div",{className:"bg-slate-50 border border-slate-200 rounded-lg p-4",children:e.jsx("p",{className:"text-slate-800",children:"⚡ Power system engineering - Newton-Raphson load flow, contingency analysis, and grid optimization"})})]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Analysis Controls"}),e.jsx("button",{onClick:z,disabled:L,className:`px-4 py-2 rounded-lg text-white font-medium ${L?"bg-gray-400 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700"} transition-colors`,children:L?"Analyzing...":"Run Load Flow"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Base Voltage: ",m.baseVoltage," kV"]}),e.jsx("input",{type:"range",min:"69",max:"500",step:"1",value:m.baseVoltage,onChange:s=>k(t=>({...t,baseVoltage:Number(s.target.value)})),className:"w-full"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Tolerance: ",m.tolerance]}),e.jsx("input",{type:"range",min:"0.0001",max:"0.01",step:"0.0001",value:m.tolerance,onChange:s=>k(t=>({...t,tolerance:Number(s.target.value)})),className:"w-full"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Max Iterations: ",m.maxIterations]}),e.jsx("input",{type:"range",min:"10",max:"100",step:"5",value:m.maxIterations,onChange:s=>k(t=>({...t,maxIterations:Number(s.target.value)})),className:"w-full"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Acceleration: ",m.accelerationFactor.toFixed(1)]}),e.jsx("input",{type:"range",min:"1.0",max:"2.0",step:"0.1",value:m.accelerationFactor,onChange:s=>k(t=>({...t,accelerationFactor:Number(s.target.value)})),className:"w-full"})]})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-3",children:"Display Options"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:p.showVoltages,onChange:s=>C(t=>({...t,showVoltages:s.target.checked})),className:"mr-2"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Bus Voltages"})]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:p.showPowerFlows,onChange:s=>C(t=>({...t,showPowerFlows:s.target.checked})),className:"mr-2"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Power Flows"})]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:p.colorCodeVoltage,onChange:s=>C(t=>({...t,colorCodeVoltage:s.target.checked})),className:"mr-2"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Color Coding"})]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:p.animatePowerFlow,onChange:s=>C(t=>({...t,animatePowerFlow:s.target.checked})),className:"mr-2"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Animate Flow"})]})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-3",children:"Bus Configuration"}),e.jsx("div",{className:"space-y-4",children:d.map(s=>e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h4",{className:"font-medium",children:[s.name," (",s.type.toUpperCase(),")"]}),e.jsx("span",{className:`px-2 py-1 rounded text-sm ${s.type==="slack"?"bg-blue-100 text-blue-800":s.type==="pv"?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:s.type==="slack"?"Reference":s.type==="pv"?"Generator":"Load"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[s.type!=="slack"&&e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Real Power: ",s.realPower," MW"]}),e.jsx("input",{type:"range",min:s.type==="pv"?"0":"-200",max:s.type==="pv"?"300":"0",step:"5",value:s.realPower,onChange:t=>T(s.id,"realPower",Number(t.target.value)),className:"w-full"})]}),s.type==="pq"&&e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Reactive Power: ",s.reactivePower," MVAr"]}),e.jsx("input",{type:"range",min:"-100",max:"50",step:"5",value:s.reactivePower,onChange:t=>T(s.id,"reactivePower",Number(t.target.value)),className:"w-full"})]}),(s.type==="slack"||s.type==="pv")&&e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Voltage Setpoint: ",s.voltageSpec.toFixed(3)," pu"]}),e.jsx("input",{type:"range",min:"0.95",max:"1.10",step:"0.005",value:s.voltageSpec,onChange:t=>T(s.id,"voltageSpec",Number(t.target.value)),className:"w-full"})]}),e.jsxs("div",{className:"text-sm",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Current:"})," ",s.voltage.toFixed(3)," pu"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Angle:"})," ",s.angle.toFixed(1),"°"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Voltage:"})," ",(s.voltage*m.baseVoltage).toFixed(1)," kV"]})]})]})]},s.id))})]}),r&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-3",children:"Analysis Results"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-4",children:[e.jsxs("div",{className:`border rounded-lg p-4 ${r.converged?"bg-green-50 border-green-200":"bg-red-50 border-red-200"}`,children:[e.jsx("h4",{className:`font-medium ${r.converged?"text-green-800":"text-red-800"}`,children:"Convergence"}),e.jsx("p",{className:`text-2xl font-bold ${r.converged?"text-green-900":"text-red-900"}`,children:r.converged?"YES":"NO"}),e.jsxs("p",{className:`text-sm ${r.converged?"text-green-600":"text-red-600"}`,children:[r.iterations," iterations"]})]}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("h4",{className:"font-medium text-blue-800",children:"Power Balance"}),e.jsxs("p",{className:"text-lg font-bold text-blue-900",children:["Gen: ",r.totalGeneration.toFixed(1)," MW"]}),e.jsxs("p",{className:"text-sm text-blue-600",children:["Load: ",r.totalLoad.toFixed(1)," MW"]})]}),e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:[e.jsx("h4",{className:"font-medium text-yellow-800",children:"System Losses"}),e.jsxs("p",{className:"text-2xl font-bold text-yellow-900",children:[r.totalLosses.toFixed(2)," MW"]}),e.jsxs("p",{className:"text-sm text-yellow-600",children:[(r.totalLosses/r.totalGeneration*100).toFixed(1),"% of generation"]})]}),e.jsxs("div",{className:`border rounded-lg p-4 ${r.systemStability==="stable"?"bg-green-50 border-green-200":r.systemStability==="marginal"?"bg-yellow-50 border-yellow-200":"bg-red-50 border-red-200"}`,children:[e.jsx("h4",{className:`font-medium ${r.systemStability==="stable"?"text-green-800":r.systemStability==="marginal"?"text-yellow-800":"text-red-800"}`,children:"Voltage Range"}),e.jsxs("p",{className:`text-lg font-bold ${r.systemStability==="stable"?"text-green-900":r.systemStability==="marginal"?"text-yellow-900":"text-red-900"}`,children:[r.minVoltage.toFixed(3)," -"," ",r.maxVoltage.toFixed(3)]}),e.jsx("p",{className:`text-sm ${r.systemStability==="stable"?"text-green-600":r.systemStability==="marginal"?"text-yellow-600":"text-red-600"}`,children:"per unit"})]})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-3",children:"Power System Single-Line Diagram"}),e.jsx("canvas",{ref:I,className:"border border-gray-300 rounded-lg bg-white",style:{maxWidth:"100%",height:"auto"}})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-slate-50 border border-slate-200 rounded-lg p-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2 text-slate-800",children:"Power System Analysis"}),e.jsxs("ul",{className:"text-slate-700 space-y-1",children:[e.jsxs("li",{children:["• ",e.jsx("strong",{children:"Newton-Raphson Method"}),": Iterative load flow solution"]}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"Bus Classifications"}),": Slack, PV, and PQ bus modeling"]}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"Admittance Matrix"}),": Network topology representation"]}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"Convergence Analysis"}),": Mismatch tolerance monitoring"]})]})]}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2 text-blue-800",children:"Engineering Applications"}),e.jsxs("ul",{className:"text-blue-700 space-y-1",children:[e.jsxs("li",{children:["• ",e.jsx("strong",{children:"Grid Planning"}),": Transmission system expansion"]}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"Operations"}),": Real-time state estimation"]}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"Protection"}),": Fault current calculations"]}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"Markets"}),": Economic dispatch optimization"]})]})]})]}),e.jsxs("div",{className:"mt-6 bg-orange-50 border border-orange-200 rounded-lg p-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2 text-orange-800",children:"IEEE Standards & Limits"}),e.jsxs("div",{className:"grid md:grid-cols-3 gap-4 text-orange-700",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Voltage Limits:"}),e.jsxs("ul",{className:"text-sm mt-1",children:[e.jsx("li",{children:"• Normal: ±5% (0.95-1.05 pu)"}),e.jsx("li",{children:"• Emergency: ±10% (0.90-1.10 pu)"}),e.jsx("li",{children:"• Critical: ±15% (0.85-1.15 pu)"})]})]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Loading Limits:"}),e.jsxs("ul",{className:"text-sm mt-1",children:[e.jsx("li",{children:"• Continuous: 100% of rating"}),e.jsx("li",{children:"• Emergency: 130% for 15 min"}),e.jsx("li",{children:"• Short-term: 150% for 5 min"})]})]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Stability Margins:"}),e.jsxs("ul",{className:"text-sm mt-1",children:[e.jsxs("li",{children:["• Angle: ","<","30° for stability"]}),e.jsxs("li",{children:["• Reactive reserve: ",">","5% of load"]}),e.jsx("li",{children:"• N-1 contingency planning"})]})]})]})]}),e.jsx("div",{className:"mt-6",children:e.jsx(oe,{to:"/examples/engineering",className:"inline-block px-4 py-2 bg-slate-600 text-white rounded-lg hover:bg-slate-700 transition-colors",children:"← Back to Examples"})})]})};export{ce as component};
