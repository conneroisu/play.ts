import{r as w,j as e,e as O}from"./index-BqTI3VMm.js";const ne=function(){const D=w.useRef(null),F=w.useRef(),[g,I]=w.useState({kp:1,ki:.1,kd:.05,setpoint:1,dt:.01}),[k,E]=w.useState({type:"second_order",timeConstant:1,dampingRatio:.7,gain:1,delay:.1}),[j,_]=w.useState({time:[],output:[],setpoint:[],error:[],control:[],proportional:[],integral:[],derivative:[]}),[v,Y]=w.useState(null),[R,V]=w.useState(!1),[$,K]=w.useState(0),[p,T]=w.useState({showSetpoint:!0,showOutput:!0,showError:!0,showControl:!0,showComponents:!1,timeWindow:10,autoScale:!0}),H={first_order:{timeConstant:1,dampingRatio:1,gain:1,delay:.1},second_order:{timeConstant:1,dampingRatio:.7,gain:1,delay:.1},integrator:{timeConstant:1,dampingRatio:1,gain:.5,delay:.05},motor:{timeConstant:.2,dampingRatio:.8,gain:2,delay:.02},thermal:{timeConstant:5,dampingRatio:1,gain:1.5,delay:.5}},X={conservative:{kp:.5,ki:.05,kd:.02},aggressive:{kp:2,ki:.5,kd:.1},pi_only:{kp:1,ki:.2,kd:0},pd_only:{kp:1.5,ki:0,kd:.1},ziegler_nichols:{kp:1.2,ki:.3,kd:.075}},q=(t,s,n)=>{const{type:r,timeConstant:l,dampingRatio:d,gain:i,delay:u}=k,a=g.dt;switch(r){case"first_order":const x=a/(l+a);return s[0]*(1-x)+t*i*x;case"second_order":const h=1/l,b=2*d*h,o=h*h,c=(i*t+2*s[0]*(1+b*a/2)-s[1]*(1-b*a+o*a*a))/(1+b*a+o*a*a);return O(c,-10,10);case"integrator":return s[0]+t*i*a;case"motor":const f=l,C=s[1]+(t*i-s[1])*a/f;return s[0]+C*a;case"thermal":const y=a/(l+a);return s[0]*(1-y)+t*i*y;default:return t*i}},z=(t,s,n)=>{const{kp:r,ki:l,kd:d,dt:i}=g,u=r*t,a=O(n+t*i,-10,10),x=l*a,h=s.length>0?d*(t-s[0])/i:0;return{control:O(u+x+h,-10,10),newIntegral:a,proportional:u,integralTerm:x,derivative:h}},G=t=>{if(t.time.length<2)return{riseTime:0,settlingTime:0,overshoot:0,steadyStateError:0,iae:0,ise:0,stability:"stable"};const s=g.setpoint,n=t.output,r=t.error,l=t.time;let d=0;const i=s*.1,u=s*.9;let a=-1,x=-1;for(let m=0;m<n.length;m++)if(a===-1&&n[m]>=i&&(a=m),x===-1&&n[m]>=u){x=m;break}a!==-1&&x!==-1&&(d=l[x]-l[a]);const h=Math.max(...n),b=Math.max(0,(h-s)/s*100);let o=l[l.length-1];const c=s*.02;for(let m=n.length-1;m>=0;m--)if(Math.abs(n[m]-s)>c){o=l[m];break}const f=Math.abs(n[n.length-1]-s);let C=0,N=0;for(let m=1;m<r.length;m++){const S=l[m]-l[m-1];C+=Math.abs(r[m])*S,N+=r[m]*r[m]*S}let y="stable";const P=n[n.length-1],M=n[n.length-2];return Math.abs(P-M)>.1||Math.abs(P)>10?y="unstable":f>.1&&(y="marginally_stable"),{riseTime:d,settlingTime:o,overshoot:b,steadyStateError:f,iae:C,ise:N,stability:y}},A=()=>{const t=p.timeWindow,s=g.dt,n=Math.floor(t/s),r=[],l=[],d=[],i=[],u=[],a=[],x=[],h=[];let b=0,o=[0,0],c=[0,0],f=[0],C=0,N=0;for(let P=0;P<n;P++){const M=P*s;r.push(M);const W=M>1?g.setpoint:0;d.push(W);const m=W-b;i.push(m);const S=z(m,f,C);N=S.control,C=S.newIntegral,u.push(N),a.push(S.proportional),x.push(S.integralTerm),h.push(S.derivative),b=q(N,o),l.push(b),o=[b,o[0]],c=[N,c[0]],f=[m]}const y={time:r,output:l,setpoint:d,error:i,control:u,proportional:a,integral:x,derivative:h};_(y),Y(G(y))},Z=()=>{const t=g.dt,s=Math.floor(p.timeWindow/t);_(n=>{const r=$,l=r>1?g.setpoint:0,d=n.output.length>0?n.output[n.output.length-1]:0,i=n.control.length>0?n.control[n.control.length-1]:0,u=l-d,a=n.integral.length>0?n.integral[n.integral.length-1]/g.ki:0,x=n.error.length>0?n.error[n.error.length-1]:0,h=z(u,[x],a),b=n.output.length>=2?[n.output[n.output.length-1],n.output[n.output.length-2]]:[d,0];n.control.length>=2&&(n.control[n.control.length-1],n.control[n.control.length-2]);const o=q(h.control,b),c={time:[...n.time,r].slice(-s),output:[...n.output,o].slice(-s),setpoint:[...n.setpoint,l].slice(-s),error:[...n.error,u].slice(-s),control:[...n.control,h.control].slice(-s),proportional:[...n.proportional,h.proportional].slice(-s),integral:[...n.integral,h.integralTerm].slice(-s),derivative:[...n.derivative,h.derivative].slice(-s)};return n.time.length%50===0&&Y(G(c)),c}),K(n=>n+t)},B=()=>{const t=D.current;if(!t)return;const s=t.getContext("2d");if(!s)return;const n=t.width,r=t.height;s.clearRect(0,0,n,r);const l=60,d=n-2*l,i=(r-4*l)/3;[{title:"System Response",y:l,datasets:[{data:j.setpoint,color:"#ef4444",label:"Setpoint",show:p.showSetpoint},{data:j.output,color:"#3b82f6",label:"Output",show:p.showOutput}]},{title:"Error Signal",y:l+i+20,datasets:[{data:j.error,color:"#f59e0b",label:"Error",show:p.showError}]},{title:"Control Signal",y:l+2*(i+20),datasets:[{data:j.control,color:"#10b981",label:"Control",show:p.showControl},{data:j.proportional,color:"#8b5cf6",label:"P",show:p.showComponents},{data:j.integral,color:"#ec4899",label:"I",show:p.showComponents},{data:j.derivative,color:"#6366f1",label:"D",show:p.showComponents}]}].forEach(a=>{J(s,a,l,a.y,d,i)})},J=(t,s,n,r,l,d)=>{if(t.fillStyle="#f8fafc",t.fillRect(n,r,l,d),t.strokeStyle="#e2e8f0",t.lineWidth=1,t.strokeRect(n,r,l,d),t.fillStyle="#1e293b",t.font="14px Arial",t.textAlign="left",t.fillText(s.title,n,r-5),j.time.length<2)return;let i=Number.POSITIVE_INFINITY,u=Number.NEGATIVE_INFINITY;const a=Math.min(...j.time),x=Math.max(...j.time);s.datasets.forEach(o=>{if(o.show&&o.data.length>0){const c=Math.min(...o.data),f=Math.max(...o.data);i=Math.min(i,c),u=Math.max(u,f)}}),i===u&&(i-=.5,u+=.5);const h=x-a,b=u-i;t.strokeStyle="#f1f5f9",t.lineWidth=1;for(let o=1;o<=4;o++){const c=r+o*d/5;t.beginPath(),t.moveTo(n,c),t.lineTo(n+l,c),t.stroke()}for(let o=1;o<=4;o++){const c=n+o*l/5;t.beginPath(),t.moveTo(c,r),t.lineTo(c,r+d),t.stroke()}s.datasets.forEach(o=>{if(!(!o.show||o.data.length===0)){t.strokeStyle=o.color,t.lineWidth=2,t.beginPath();for(let c=0;c<o.data.length;c++){const f=j.time[c],C=o.data[c],N=n+(f-a)/h*l,y=r+d-(C-i)/b*d;c===0?t.moveTo(N,y):t.lineTo(N,y)}t.stroke()}}),t.fillStyle="#64748b",t.font="10px Arial",t.textAlign="center";for(let o=0;o<=4;o++){const c=a+o*h/4,f=n+o*l/4;t.fillText(c.toFixed(1),f,r+d+15)}t.textAlign="right";for(let o=0;o<=4;o++){const c=i+o*b/4,f=r+d-o*d/4+3;t.fillText(c.toFixed(2),n-5,f)}},L=()=>{R&&Z(),B(),F.current=requestAnimationFrame(L)};w.useEffect(()=>{const t=D.current;t&&(t.width=800,t.height=600),A()},[g,k,p.timeWindow]),w.useEffect(()=>(F.current=requestAnimationFrame(L),()=>{F.current&&cancelAnimationFrame(F.current)}),[R,j]);const Q=t=>{I(s=>({...s,...X[t]}))},U=t=>{E(s=>({...s,...H[t],type:t}))},ee=()=>{V(!1),K(0),_({time:[],output:[],setpoint:[],error:[],control:[],proportional:[],integral:[],derivative:[]}),A()};return e.jsx("div",{className:"w-full max-w-7xl mx-auto p-6 bg-gradient-to-br from-blue-50 to-indigo-50 min-h-screen",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-6 mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"w-3 h-3 bg-gradient-to-r from-blue-500 to-indigo-500 rounded-full"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"PID Controller Design & Tuning"}),e.jsx("div",{className:"text-sm text-gray-600 bg-gray-100 px-3 py-1 rounded-full",children:"Control Systems Engineering Tool"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6",children:[e.jsxs("div",{className:"lg:col-span-3",children:[e.jsx("div",{className:"bg-gray-50 rounded-lg p-4 mb-4",children:e.jsx("canvas",{ref:D,className:"border border-gray-300 rounded-lg bg-white w-full"})}),e.jsxs("div",{className:"flex gap-2 mb-4",children:[e.jsxs("button",{onClick:()=>V(!R),className:`px-4 py-2 rounded-lg font-medium ${R?"bg-red-500 text-white hover:bg-red-600":"bg-green-500 text-white hover:bg-green-600"}`,children:[R?"Stop":"Start"," Real-time"]}),e.jsx("button",{onClick:ee,className:"px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600",children:"Reset"}),e.jsx("button",{onClick:A,className:"px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600",children:"Run Simulation"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-3",children:"PID Parameters"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Kp (Proportional): ",g.kp.toFixed(2)]}),e.jsx("input",{type:"range",min:"0",max:"5",step:"0.1",value:g.kp,onChange:t=>I(s=>({...s,kp:Number.parseFloat(t.target.value)})),className:"w-full"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Ki (Integral): ",g.ki.toFixed(3)]}),e.jsx("input",{type:"range",min:"0",max:"2",step:"0.01",value:g.ki,onChange:t=>I(s=>({...s,ki:Number.parseFloat(t.target.value)})),className:"w-full"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Kd (Derivative): ",g.kd.toFixed(3)]}),e.jsx("input",{type:"range",min:"0",max:"1",step:"0.001",value:g.kd,onChange:t=>I(s=>({...s,kd:Number.parseFloat(t.target.value)})),className:"w-full"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Setpoint: ",g.setpoint.toFixed(1)]}),e.jsx("input",{type:"range",min:"0.5",max:"2",step:"0.1",value:g.setpoint,onChange:t=>I(s=>({...s,setpoint:Number.parseFloat(t.target.value)})),className:"w-full"})]})]}),e.jsxs("div",{className:"mt-3",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"PID Presets"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:Object.keys(X).map(t=>e.jsx("button",{onClick:()=>Q(t),className:"px-2 py-1 text-xs bg-blue-100 text-blue-800 rounded hover:bg-blue-200 transition-colors",children:t.replace("_"," ")},t))})]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-3",children:"Plant Model"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Plant Type"}),e.jsxs("select",{value:k.type,onChange:t=>{const s=t.target.value;U(s)},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"first_order",children:"First Order"}),e.jsx("option",{value:"second_order",children:"Second Order"}),e.jsx("option",{value:"integrator",children:"Integrator"}),e.jsx("option",{value:"motor",children:"DC Motor"}),e.jsx("option",{value:"thermal",children:"Thermal System"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Time Constant: ",k.timeConstant.toFixed(2)]}),e.jsx("input",{type:"range",min:"0.1",max:"10",step:"0.1",value:k.timeConstant,onChange:t=>E(s=>({...s,timeConstant:Number.parseFloat(t.target.value)})),className:"w-full"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Damping Ratio: ",k.dampingRatio.toFixed(2)]}),e.jsx("input",{type:"range",min:"0.1",max:"2",step:"0.1",value:k.dampingRatio,onChange:t=>E(s=>({...s,dampingRatio:Number.parseFloat(t.target.value)})),className:"w-full"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Plant Gain: ",k.gain.toFixed(2)]}),e.jsx("input",{type:"range",min:"0.1",max:"5",step:"0.1",value:k.gain,onChange:t=>E(s=>({...s,gain:Number.parseFloat(t.target.value)})),className:"w-full"})]})]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-3",children:"Display Options"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:p.showSetpoint,onChange:t=>T(s=>({...s,showSetpoint:t.target.checked})),className:"mr-2"}),"Setpoint"]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:p.showOutput,onChange:t=>T(s=>({...s,showOutput:t.target.checked})),className:"mr-2"}),"Output"]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:p.showError,onChange:t=>T(s=>({...s,showError:t.target.checked})),className:"mr-2"}),"Error"]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:p.showControl,onChange:t=>T(s=>({...s,showControl:t.target.checked})),className:"mr-2"}),"Control Signal"]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:p.showComponents,onChange:t=>T(s=>({...s,showComponents:t.target.checked})),className:"mr-2"}),"PID Components"]})]}),e.jsxs("div",{className:"mt-3",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Time Window: ",p.timeWindow,"s"]}),e.jsx("input",{type:"range",min:"5",max:"30",step:"1",value:p.timeWindow,onChange:t=>T(s=>({...s,timeWindow:Number.parseInt(t.target.value)})),className:"w-full"})]})]}),v&&e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-3",children:"Performance Metrics"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Rise Time:"}),e.jsxs("span",{className:"font-mono",children:[v.riseTime.toFixed(2),"s"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Settling Time:"}),e.jsxs("span",{className:"font-mono",children:[v.settlingTime.toFixed(2),"s"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Overshoot:"}),e.jsxs("span",{className:"font-mono",children:[v.overshoot.toFixed(1),"%"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"SS Error:"}),e.jsx("span",{className:"font-mono",children:v.steadyStateError.toFixed(3)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"IAE:"}),e.jsx("span",{className:"font-mono",children:v.iae.toFixed(3)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"ISE:"}),e.jsx("span",{className:"font-mono",children:v.ise.toFixed(3)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Stability:"}),e.jsx("span",{className:`font-mono ${v.stability==="stable"?"text-green-600":v.stability==="marginally_stable"?"text-yellow-600":"text-red-600"}`,children:v.stability.replace("_"," ")})]})]})]})]})]}),e.jsxs("div",{className:"mt-6 bg-blue-50 rounded-lg p-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-blue-800 mb-2",children:"Control Systems Applications"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm text-blue-700",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Industrial Applications:"}),e.jsxs("ul",{className:"mt-1 space-y-1",children:[e.jsx("li",{children:"• Temperature control systems"}),e.jsx("li",{children:"• Motor speed control"}),e.jsx("li",{children:"• Process automation"}),e.jsx("li",{children:"• Flow rate regulation"})]})]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Performance Tuning:"}),e.jsxs("ul",{className:"mt-1 space-y-1",children:[e.jsx("li",{children:"• Ziegler-Nichols method"}),e.jsx("li",{children:"• Cohen-Coon tuning"}),e.jsx("li",{children:"• Lambda tuning"}),e.jsx("li",{children:"• Manual optimization"})]})]})]})]})]})})};export{ne as component};
