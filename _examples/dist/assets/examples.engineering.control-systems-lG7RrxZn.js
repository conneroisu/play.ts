import{r as b,j as t,e as te,s as z,T as H}from"./index-BqTI3VMm.js";const ae=function(){const W=b.useRef(null),I=b.useRef(),P=b.useRef(0),[C,V]=b.useState(!1),[l,D]=b.useState([]),[k,A]=b.useState([]),[o,y]=b.useState({kp:1,ki:.1,kd:.05,setpoint:1,integral:0,previousError:0,derivative:0,output:0,enabled:!0}),[a,N]=b.useState({type:"mass_spring_damper",mass:1,damping:.5,stiffness:1,gain:1,timeConstant:1,deadTime:0,nonlinearity:0,disturbance:0,noise:0}),[r,_]=b.useState({timeStep:.01,duration:10,sampleTime:.01,realTime:!1,showSetpoint:!0,showOutput:!0,showError:!0,showControl:!1,showDerivative:!1,showIntegral:!1,gridEnabled:!0,autoScale:!1}),[R,L]=b.useState("pid"),[q,G]=b.useState("step"),[U,ne]=b.useState("manual"),Y=s=>{switch(s){case"mass_spring_damper":N(e=>({...e,mass:1,damping:.5,stiffness:.1,gain:1,timeConstant:1}));break;case"dc_motor":N(e=>({...e,mass:.1,damping:.2,stiffness:0,gain:10,timeConstant:.5}));break;case"temperature":N(e=>({...e,mass:5,damping:1,stiffness:0,gain:.8,timeConstant:3}));break;case"level_control":N(e=>({...e,mass:2,damping:.3,stiffness:0,gain:1.2,timeConstant:2}));break}},X=s=>{const e=a.gain,c=a.mass;a.damping;const i=2/e,p=Math.sqrt(c)*2;switch(s==="manual"?"ziegler_nichols":s){case"ziegler_nichols":y(v=>({...v,kp:.6*i,ki:1.2*i/p,kd:.075*i*p})),console.log("Auto-tuned PID using Ziegler-Nichols:",{Ku:i,Tu:p,plantGain:e,plantMass:c});break;case"cohen_coon":const d=a.timeConstant,f=a.gain,x=a.deadTime||.1;y(v=>({...v,kp:1.35/f*(d/x)*(1+x/(4*d)),ki:1.35/f*(d/x)*(1+x/(4*d))/(d*(1+x/(12*d))),kd:1.35/f*(d/x)*(1+x/(4*d))*d*x/(4*d+x)}));break;case"lambda":const j=a.timeConstant;y(v=>({...v,kp:a.timeConstant/(a.gain*j),ki:1/j,kd:0}));break}Y("dc_motor"),P.current=0,D([]),A([]),y(d=>({...d,integral:0,previousError:0,derivative:0,output:0}))},O=s=>{let e;switch(q){case"step":e=s>.1?o.setpoint:0;break;case"ramp":e=s>.1?(s-.1)*.5:0;break;case"sine":e=s>.1?o.setpoint*z(H*.2*s):0;break;case"square":e=s>.1?z(H*.1*s)>0?o.setpoint:-o.setpoint:0;break;default:e=o.setpoint}return e},Z=(s,e,c)=>{const i=s+a.disturbance+(Math.random()-.5)*a.noise;let p;switch(a.type){case"mass_spring_damper":p=(i*a.gain-a.damping*e.velocity)/a.mass;break;case"dc_motor":p=(i*a.gain-a.damping*e.velocity)/a.mass;break;case"temperature":p=(i*a.gain-e.position)/(a.mass*a.timeConstant);break;case"level_control":p=i*a.gain/a.mass-a.damping*e.velocity/a.mass;break;default:p=i*a.gain/a.mass}a.nonlinearity>0&&(p=Math.tanh(p/a.nonlinearity)*a.nonlinearity);const m=e.velocity+p*r.timeStep;return{position:e.position+m*r.timeStep,velocity:m,acceleration:p,time:c+r.timeStep,error:0,errorIntegral:0,errorDerivative:0}},B=s=>{if(!o.enabled)return 0;const c=O(s.time)-s.position;let i=0,p=0,m=0;switch(R){case"pid":i=o.kp*c,o.integral+=c*r.timeStep,p=o.ki*o.integral,m=o.kd*(c-o.previousError)/r.timeStep;break;case"p":i=o.kp*c;break;case"pi":i=o.kp*c,o.integral+=c*r.timeStep,p=o.ki*o.integral;break;case"pd":i=o.kp*c,m=o.kd*(c-o.previousError)/r.timeStep;break;case"manual":return o.output}const d=i+p+m,f=10,x=te(d,-f,f);return Math.abs(d)>f&&(o.integral-=(d-x)/o.ki*r.timeStep),o.previousError=c,o.output=x,x},J=()=>{var M,$;if(l.length<100)return null;const s=o.setpoint,e=((M=l[l.length-1])==null?void 0:M.position)||0,c=Math.abs(s-e);let i=0;const p=.1*s,m=.9*s;let d=-1,f=-1;for(let u=0;u<l.length;u++)if(d===-1&&l[u].position>=p&&(d=u),f===-1&&l[u].position>=m){f=u;break}d!==-1&&f!==-1&&(i=(f-d)*r.timeStep);let x=0,j=0;for(let u=0;u<l.length;u++)l[u].position>x&&(x=l[u].position,j=l[u].time);const v=Math.max(0,(x-s)/s*100);let T=(($=l[l.length-1])==null?void 0:$.time)||0;const S=.02*Math.abs(s);for(let u=l.length-1;u>=0;u--)if(Math.abs(l[u].position-s)>S){T=l[u].time;break}let E=0,n=0;for(const u of l){const F=Math.abs(s-u.position);E+=F*r.timeStep,n+=F*F*r.timeStep}let g=0,h=0;for(let u=1;u<l.length;u++){const F=l[u].position-l[u-1].position;h>0&&F<0&&g++,h=F}return{riseTime:i,settlingTime:T,overshoot:v,steadyStateError:c,integralAbsoluteError:E,integralSquaredError:n,peakTime:j,oscillations:g}},Q=()=>{var E;const s=W.current;if(!s)return;const e=s.getContext("2d");if(!e)return;const c=s.width,i=s.height;e.fillStyle="#f8fafc",e.fillRect(0,0,c,i),e.strokeStyle="rgba(200, 200, 200, 0.5)",e.lineWidth=1,e.beginPath();for(let n=0;n<=c;n+=50)e.moveTo(n,0),e.lineTo(n,i);for(let n=0;n<=i;n+=50)e.moveTo(0,n),e.lineTo(c,n);if(e.stroke(),e.strokeStyle="rgba(100, 100, 100, 0.8)",e.lineWidth=2,e.beginPath(),e.moveTo(0,i/2),e.lineTo(c,i/2),e.stroke(),e.beginPath(),e.moveTo(50,0),e.lineTo(50,i),e.stroke(),l.length<2){e.fillStyle="#6b7280",e.font="16px Arial",e.textAlign="center",e.fillText("Waiting for simulation data...",c/2,i/2);return}const p=500;let m=l;if(l.length>p){const n=Math.ceil(l.length/p);m=l.filter((g,h)=>h%n===0),l.length>0&&m.push(l[l.length-1])}l.length%100===0&&console.log(`CANVAS: ${l.length} total, ${m.length} rendered, mode: ${R}, plant: ${a.type}`);let d=r.autoScale?Math.min(...m.map(n=>n.position)):-2,f=r.autoScale?Math.max(...m.map(n=>n.position)):3;const x=(f-d)*.1;d-=x,f+=x;const j=((E=m[m.length-1])==null?void 0:E.time)||r.duration;if(r.gridEnabled){e.strokeStyle="rgba(200, 200, 200, 0.5)",e.lineWidth=1;for(let g=0;g<=j;g+=1){const h=g/j*c;e.beginPath(),e.moveTo(h,0),e.lineTo(h,i),e.stroke()}const n=8;for(let g=0;g<=n;g++){const h=g/n*i;e.beginPath(),e.moveTo(0,h),e.lineTo(c,h),e.stroke()}}const v=n=>n/j*c,T=n=>i-(n-d)/(f-d)*i;if(console.log("Scale info - minY:",d,"maxY:",f,"maxTime:",j,"data range:",Math.min(...l.map(n=>n.position)),"to",Math.max(...l.map(n=>n.position))),r.showSetpoint){e.strokeStyle="rgba(128, 128, 128, 0.8)",e.lineWidth=2,e.setLineDash([5,5]),e.beginPath();for(let n=0;n<m.length;n++){const g=O(m[n].time),h=v(m[n].time),M=T(g);n===0?e.moveTo(h,M):e.lineTo(h,M)}e.stroke(),e.setLineDash([])}if(r.showOutput){e.strokeStyle="rgba(59, 130, 246, 1)",e.lineWidth=3,e.beginPath();for(let n=0;n<m.length;n++){const g=v(m[n].time),h=T(m[n].position);n===0?e.moveTo(g,h):e.lineTo(g,h)}e.stroke()}if(r.showError&&k.length>0){e.strokeStyle="rgba(239, 68, 68, 0.7)",e.lineWidth=2,e.beginPath();for(let n=0;n<k.length;n++){const g=v(k[n].time),h=T(k[n].error*.5);n===0?e.moveTo(g,h):e.lineTo(g,h)}e.stroke()}if(r.showControl&&k.length>0){e.strokeStyle="rgba(34, 197, 94, 0.7)",e.lineWidth=2,e.beginPath();for(let n=0;n<k.length;n++){const g=v(k[n].time),h=T(k[n].output*.2);n===0?e.moveTo(g,h):e.lineTo(g,h)}e.stroke()}e.fillStyle="rgba(0, 0, 0, 0.8)",e.font="12px monospace",e.textAlign="left";let S=20;r.showSetpoint&&(e.fillStyle="rgba(128, 128, 128, 0.8)",e.fillText("Setpoint",10,S),S+=20),r.showOutput&&(e.fillStyle="rgba(59, 130, 246, 1)",e.fillText("Output",10,S),S+=20),r.showError&&(e.fillStyle="rgba(239, 68, 68, 0.7)",e.fillText("Error (×0.5)",10,S),S+=20),r.showControl&&(e.fillStyle="rgba(34, 197, 94, 0.7)",e.fillText("Control (×0.2)",10,S))},K=b.useCallback(()=>{if(!C)return;const s=P.current,e=l[l.length-1]||{position:0,velocity:0,time:0},c=B(e),i=Z(c,e,s),p=O(i.time);i.error=p-i.position,i.time%5<.1&&console.log("SIMULATION DATA:",{time:i.time.toFixed(2),position:i.position.toFixed(3),velocity:i.velocity.toFixed(3),acceleration:i.acceleration.toFixed(3),controlSignal:c.toFixed(3),setpoint:O(i.time).toFixed(3)}),D(m=>[...m.slice(-1e3),i]),A(m=>[...m.slice(-1e3),{time:i.time,output:c,error:i.error,integral:o.integral,derivative:o.derivative}]),P.current+=r.timeStep,s>=r.duration&&(P.current=0,D([]),A([]),y(m=>({...m,integral:0,previousError:0,derivative:0,output:0})))},[C,l,o,a,r,R,q]),ee=()=>{V(!1),P.current=0,D([]),A([]),y(s=>({...s,integral:0,previousError:0,derivative:0,output:0}))};b.useEffect(()=>{const s=W.current;if(!s)return;s.width=700,s.height=400,console.log("Canvas initialized:",{width:s.width,height:s.height,offsetWidth:s.offsetWidth,offsetHeight:s.offsetHeight});const e=s.getContext("2d");e&&(e.fillStyle="#f0f9ff",e.fillRect(0,0,s.width,s.height),e.fillStyle="#1e40af",e.font="16px Arial",e.fillText("PID Control System Ready",20,30),console.log("Canvas initial draw complete"))},[]),b.useEffect(()=>{if(C){const s=setInterval(K,r.realTime?r.timeStep*1e3:16);return()=>clearInterval(s)}},[C,r.realTime,r.timeStep,K]),b.useEffect(()=>{let s=0;const c=1e3/30,i=p=>{p-s>=c&&(Q(),s=p),I.current=requestAnimationFrame(i)};return I.current=requestAnimationFrame(i),()=>{I.current&&cancelAnimationFrame(I.current)}},[l,k,r]);const w=J();return t.jsx("div",{className:"w-full max-w-6xl mx-auto p-6 bg-gradient-to-br from-blue-50 to-indigo-50 min-h-screen",children:t.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-6 mb-6",children:[t.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[t.jsx("div",{className:"w-3 h-3 bg-gradient-to-r from-blue-500 to-indigo-500 rounded-full"}),t.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"Control Systems & PID Analysis"}),t.jsx("div",{className:"text-sm text-gray-600 bg-gray-100 px-3 py-1 rounded-full",children:"Control Engineering Tool"})]}),t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6",children:[t.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[t.jsx("div",{className:"text-sm text-gray-600 mb-2",children:"PID Control System Visualization"}),t.jsx("div",{className:"bg-red-100 p-2 mb-2 text-xs",children:"Canvas should appear below this line:"}),t.jsx("canvas",{ref:W,id:"pid-canvas",className:"border-2 border-blue-500 bg-white block",style:{width:"700px",height:"400px"},children:"Canvas not supported"}),t.jsx("div",{className:"bg-green-100 p-2 mt-2 text-xs",children:"Canvas should appear above this line"}),t.jsxs("div",{className:"flex gap-2 mt-4",children:[t.jsxs("button",{onClick:()=>V(!C),className:`px-4 py-2 rounded-lg font-medium ${C?"bg-red-500 text-white hover:bg-red-600":"bg-green-500 text-white hover:bg-green-600"}`,children:[C?"Stop":"Start"," Simulation"]}),t.jsx("button",{onClick:ee,className:"px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600",children:"Reset"}),t.jsx("button",{onClick:()=>X(U),className:"px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600",children:"Auto-Tune PID"})]})]}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-3",children:"PID Controller"}),t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Control Mode"}),t.jsxs("select",{value:R,onChange:s=>L(s.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent mb-3",children:[t.jsx("option",{value:"pid",children:"PID"}),t.jsx("option",{value:"p",children:"P Only"}),t.jsx("option",{value:"pi",children:"PI"}),t.jsx("option",{value:"pd",children:"PD"}),t.jsx("option",{value:"manual",children:"Manual"})]}),t.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Kp (Proportional): ",o.kp.toFixed(3)]}),t.jsx("input",{type:"range",min:"0",max:"10",step:"0.1",value:o.kp,onChange:s=>y(e=>({...e,kp:Number.parseFloat(s.target.value)})),className:"w-full mb-3"}),t.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Ki (Integral): ",o.ki.toFixed(3)]}),t.jsx("input",{type:"range",min:"0",max:"2",step:"0.01",value:o.ki,onChange:s=>y(e=>({...e,ki:Number.parseFloat(s.target.value)})),className:"w-full mb-3"}),t.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Kd (Derivative): ",o.kd.toFixed(3)]}),t.jsx("input",{type:"range",min:"0",max:"1",step:"0.001",value:o.kd,onChange:s=>y(e=>({...e,kd:Number.parseFloat(s.target.value)})),className:"w-full mb-3"}),t.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Setpoint: ",o.setpoint.toFixed(2)]}),t.jsx("input",{type:"range",min:"-2",max:"3",step:"0.1",value:o.setpoint,onChange:s=>y(e=>({...e,setpoint:Number.parseFloat(s.target.value)})),className:"w-full"})]}),t.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-3",children:"Plant Model"}),t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"System Type"}),t.jsxs("select",{value:a.type,onChange:s=>{N(e=>({...e,type:s.target.value})),Y(s.target.value)},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent mb-3",children:[t.jsx("option",{value:"mass_spring_damper",children:"Mass-Spring-Damper"}),t.jsx("option",{value:"dc_motor",children:"DC Motor"}),t.jsx("option",{value:"temperature",children:"Temperature Control"}),t.jsx("option",{value:"level_control",children:"Level Control"}),t.jsx("option",{value:"custom",children:"Custom"})]}),t.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Mass/Inertia: ",a.mass.toFixed(2)]}),t.jsx("input",{type:"range",min:"0.1",max:"5",step:"0.1",value:a.mass,onChange:s=>N(e=>({...e,mass:Number.parseFloat(s.target.value)})),className:"w-full mb-3"}),t.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Damping: ",a.damping.toFixed(2)]}),t.jsx("input",{type:"range",min:"0",max:"2",step:"0.1",value:a.damping,onChange:s=>N(e=>({...e,damping:Number.parseFloat(s.target.value)})),className:"w-full mb-3"}),t.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Disturbance: ",a.disturbance.toFixed(2)]}),t.jsx("input",{type:"range",min:"-1",max:"1",step:"0.01",value:a.disturbance,onChange:s=>N(e=>({...e,disturbance:Number.parseFloat(s.target.value)})),className:"w-full"})]}),t.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-3",children:"Display Options"}),t.jsxs("div",{className:"space-y-2 mb-3",children:[t.jsxs("label",{className:"flex items-center",children:[t.jsx("input",{type:"checkbox",checked:r.showSetpoint,onChange:s=>_(e=>({...e,showSetpoint:s.target.checked})),className:"mr-2"}),"Setpoint"]}),t.jsxs("label",{className:"flex items-center",children:[t.jsx("input",{type:"checkbox",checked:r.showOutput,onChange:s=>_(e=>({...e,showOutput:s.target.checked})),className:"mr-2"}),"System Output"]}),t.jsxs("label",{className:"flex items-center",children:[t.jsx("input",{type:"checkbox",checked:r.showError,onChange:s=>_(e=>({...e,showError:s.target.checked})),className:"mr-2"}),"Error Signal"]}),t.jsxs("label",{className:"flex items-center",children:[t.jsx("input",{type:"checkbox",checked:r.showControl,onChange:s=>_(e=>({...e,showControl:s.target.checked})),className:"mr-2"}),"Control Signal"]})]}),t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Setpoint Type"}),t.jsxs("select",{value:q,onChange:s=>G(s.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[t.jsx("option",{value:"step",children:"Step Response"}),t.jsx("option",{value:"ramp",children:"Ramp Input"}),t.jsx("option",{value:"sine",children:"Sine Wave"}),t.jsx("option",{value:"square",children:"Square Wave"}),t.jsx("option",{value:"custom",children:"Custom"})]})]}),w&&t.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-3",children:"Performance Metrics"}),t.jsxs("div",{className:"space-y-2 text-sm",children:[t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{children:"Rise Time:"}),t.jsxs("span",{className:"font-mono",children:[w.riseTime.toFixed(2)," s"]})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{children:"Settling Time:"}),t.jsxs("span",{className:"font-mono",children:[w.settlingTime.toFixed(2)," s"]})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{children:"Overshoot:"}),t.jsxs("span",{className:"font-mono",children:[w.overshoot.toFixed(1),"%"]})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{children:"Steady-State Error:"}),t.jsx("span",{className:"font-mono",children:w.steadyStateError.toFixed(3)})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{children:"IAE:"}),t.jsx("span",{className:"font-mono",children:w.integralAbsoluteError.toFixed(2)})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{children:"ISE:"}),t.jsx("span",{className:"font-mono",children:w.integralSquaredError.toFixed(2)})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{children:"Oscillations:"}),t.jsx("span",{className:"font-mono",children:w.oscillations})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{children:"Simulation Time:"}),t.jsxs("span",{className:"font-mono",children:[P.current.toFixed(1)," s"]})]})]})]})]})]}),t.jsxs("div",{className:"mt-6 bg-blue-50 rounded-lg p-4",children:[t.jsx("h3",{className:"text-lg font-semibold text-blue-800 mb-2",children:"Control Engineering Applications"}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm text-blue-700",children:[t.jsxs("div",{children:[t.jsx("strong",{children:"Industrial Automation:"}),t.jsxs("ul",{className:"mt-1 space-y-1",children:[t.jsx("li",{children:"• Process control systems"}),t.jsx("li",{children:"• Motor speed control"}),t.jsx("li",{children:"• Temperature regulation"}),t.jsx("li",{children:"• Pressure control loops"})]})]}),t.jsxs("div",{children:[t.jsx("strong",{children:"Robotics & Mechatronics:"}),t.jsxs("ul",{className:"mt-1 space-y-1",children:[t.jsx("li",{children:"• Robot joint control"}),t.jsx("li",{children:"• Flight control systems"}),t.jsx("li",{children:"• Automotive cruise control"}),t.jsx("li",{children:"• Medical device control"})]})]})]})]})]})})};export{ae as component};
