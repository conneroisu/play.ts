import{r as u,j as e,e as R,l as W}from"./index-BqTI3VMm.js";const le=function(){const B=u.useRef(null),P=u.useRef(0),j=u.useRef(new Map),I=u.useRef(new Map),A=u.useRef([]),U=u.useRef({total_requests:0,success_rate:99.5,avg_latency:45,p99_latency:150,active_connections:0,retries:0,circuit_breakers_open:0,mtls_enabled:!0}),[T,O]=u.useState(!0),[w,H]=u.useState(1),[g,J]=u.useState("topology"),[_,K]=u.useState("user-service"),[M,Q]=u.useState("latency"),[D,X]=u.useState(!0),[L,Y]=u.useState(!0),[v,Z]=u.useState("istio"),[b,z]=u.useState("istio"),[C,ee]=u.useState("normal"),[N,te]=u.useState("none"),$={istio:{bg:"#0F1419",healthy:"#00D084",degraded:"#FF9500",unhealthy:"#FF4757",gateway:"#466BB0",request:"#00D4FF",text:"#FFFFFF",mesh:"#7209B7",proxy:"#2ED573"},linkerd:{bg:"#1B1D23",healthy:"#00D4FF",degraded:"#FFA726",unhealthy:"#F44336",gateway:"#2196F3",request:"#E91E63",text:"#FFFFFF",mesh:"#9C27B0",proxy:"#4CAF50"},consul:{bg:"#000000",healthy:"#CA2171",degraded:"#DC477D",unhealthy:"#F596AA",gateway:"#8C1C84",request:"#DC477D",text:"#FFFFFF",mesh:"#F596AA",proxy:"#CA2171"}};return u.useEffect(()=>{const s=new Map,r=new Map;[{name:"user-service",namespace:"default",x:20,y:10,deps:["auth-service","profile-service"]},{name:"auth-service",namespace:"security",x:5,y:20,deps:["database-service"]},{name:"profile-service",namespace:"default",x:35,y:20,deps:["database-service","cache-service"]},{name:"order-service",namespace:"commerce",x:50,y:10,deps:["payment-service","inventory-service"]},{name:"payment-service",namespace:"commerce",x:65,y:20,deps:["bank-api","fraud-detection"]},{name:"inventory-service",namespace:"commerce",x:35,y:30,deps:["database-service"]},{name:"notification-service",namespace:"messaging",x:80,y:15,deps:["email-service","sms-service"]},{name:"database-service",namespace:"data",x:20,y:35,deps:[]},{name:"cache-service",namespace:"data",x:50,y:35,deps:[]},{name:"api-gateway",namespace:"gateway",x:10,y:5,deps:["user-service","order-service"]},{name:"email-service",namespace:"external",x:95,y:10,deps:[]},{name:"sms-service",namespace:"external",x:95,y:20,deps:[]},{name:"bank-api",namespace:"external",x:80,y:30,deps:[]},{name:"fraud-detection",namespace:"security",x:65,y:35,deps:["ml-service"]},{name:"ml-service",namespace:"ai",x:80,y:40,deps:[]}].forEach((p,E)=>{const S={id:`svc-${E}`,name:p.name,version:"v"+(Math.floor(Math.random()*3)+1)+"."+Math.floor(Math.random()*10),namespace:p.namespace,status:Math.random()>.95?"degraded":"healthy",replicas:Math.floor(Math.random()*5)+1,cpu_usage:Math.random()*80+10,memory_usage:Math.random()*70+20,request_rate:Math.random()*1e3+100,error_rate:Math.random()*5,response_time:Math.random()*100+20,x:p.x,y:p.y,dependencies:p.deps,endpoints:[{path:"/health",method:"GET",request_count:0,avg_latency:10,error_count:0},{path:"/api/v1",method:"GET",request_count:0,avg_latency:45,error_count:0},{path:"/api/v1",method:"POST",request_count:0,avg_latency:80,error_count:0}],circuit_breaker_state:"closed",retry_count:0,timeout_ms:5e3,istio_enabled:b==="istio",envoy_proxy:b==="istio"||b==="linkerd"};s.set(S.id,S)}),[{name:"istio-ingress",type:"ingress",host:"api.example.com",port:443,x:5,y:1},{name:"istio-egress",type:"egress",host:"external-apis",port:443,x:95,y:1},{name:"internal-gateway",type:"internal",host:"internal.svc.cluster.local",port:80,x:50,y:1}].forEach((p,E)=>{const S={id:`gw-${E}`,name:p.name,type:p.type,host:p.host,port:p.port,ssl_enabled:p.port===443,rate_limit:1e3,requests_per_second:Math.random()*500+100,connected_services:p.type==="ingress"?["api-gateway"]:p.type==="egress"?["email-service","sms-service","bank-api"]:["user-service","order-service"],x:p.x,y:p.y};r.set(S.id,S)}),j.current=s,I.current=r},[b]),u.useEffect(()=>{const s=B.current;if(!s)return;const r=s.getContext("2d");if(!r)return;const q=()=>{s.width=s.offsetWidth,s.height=s.offsetHeight},V=()=>{const a=j.current,i=I.current,n=U.current,l=Date.now()/1e3;if(a.forEach(t=>{let d=1;C==="spike"?d=1+2*Math.sin(l*2):C==="gradual-increase"?d=1+l%60/60:C==="random-bursts"&&(d=Math.random()<.1?3:1),N==="latency"&&t.name===_?t.response_time=Math.min(5e3,t.response_time+1e3):N==="errors"&&t.name===_?t.error_rate=Math.min(50,t.error_rate+10):N==="circuit-breaker"&&t.name===_&&(t.circuit_breaker_state="open"),t.request_rate=R(t.request_rate*d+(Math.random()-.5)*50,10,2e3),t.response_time=R(t.response_time+(Math.random()-.5)*10,10,t.circuit_breaker_state==="open"?5e3:500),t.error_rate=R(t.error_rate+(Math.random()-.5)*1,0,t.circuit_breaker_state==="open"?50:10),t.cpu_usage=R(t.cpu_usage+(Math.random()-.5)*5,5,95),t.memory_usage=R(t.memory_usage+(Math.random()-.5)*3,10,90),t.error_rate>10||t.response_time>1e3?t.status="unhealthy":t.error_rate>5||t.response_time>500?t.status="degraded":t.status="healthy",t.error_rate>20&&t.circuit_breaker_state==="closed"?t.circuit_breaker_state="open":t.circuit_breaker_state==="open"&&Math.random()<.05?t.circuit_breaker_state="half-open":t.circuit_breaker_state==="half-open"&&t.error_rate<5&&(t.circuit_breaker_state="closed"),t.endpoints.forEach(m=>{m.request_count+=Math.floor(t.request_rate/10),m.avg_latency=t.response_time+(Math.random()-.5)*20,m.error_count+=Math.floor(t.error_rate/5)})}),i.forEach(t=>{t.requests_per_second=R(t.requests_per_second+(Math.random()-.5)*50,50,1500)}),Math.random()<.2*w&&D){const d=Array.from(a.values()).filter(m=>m.dependencies.length>0);if(d.length>0){const m=d[Math.floor(Math.random()*d.length)],y=m.dependencies[Math.floor(Math.random()*m.dependencies.length)],k=Array.from(a.values()).find(F=>F.name===y);if(k){const F=m.circuit_breaker_state==="open"||Math.random()<.1;A.current.push({id:`req-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,from_service:m.id,to_service:k.id,progress:0,method:Math.random()<.7?"GET":"POST",path:"/api/v1",status_code:k.error_rate>10?Math.random()<.3?500:200:Math.random()<.05?404:200,latency:k.response_time+(Math.random()-.5)*20,retry_attempt:F?Math.floor(Math.random()*3):0,trace_id:Math.random().toString(36).substr(2,16),span_id:Math.random().toString(36).substr(2,8)})}}}A.current=A.current.filter(t=>(t.progress+=.03*w,t.progress<1));const o=a.size,h=Array.from(a.values()).filter(t=>t.status==="healthy").length,f=Array.from(a.values()).filter(t=>t.circuit_breaker_state==="open").length,c=Array.from(a.values()).reduce((t,d)=>t+d.request_rate,0),x=Array.from(a.values()).reduce((t,d)=>t+d.response_time,0)/o;n.success_rate=h/o*100,n.avg_latency=x,n.p99_latency=Math.max(...Array.from(a.values()).map(t=>t.response_time)),n.active_connections=A.current.length,n.circuit_breakers_open=f,n.total_requests=c},p=(a,i)=>a.status==="unhealthy"?i.unhealthy:a.status==="degraded"||a.status==="starting"?i.degraded:i.healthy,E=(a,i)=>{const n=a.x*i,l=a.y*i,o=$[v];r.fillStyle=p(a,o);let h="●";a.circuit_breaker_state==="open"?h="◐":a.envoy_proxy?h="◆":a.istio_enabled&&(h="◇"),r.fillText(h,n,l),r.fillStyle=o.text;const f=a.name.length>15?a.name.substring(0,15)+"...":a.name;if(r.fillText(f,n+i,l),r.fillStyle=o.text+"80",r.fillText(a.version,n+i*16,l),a.circuit_breaker_state!=="closed"&&(r.fillStyle=a.circuit_breaker_state==="open"?o.unhealthy:o.degraded,r.fillText(a.circuit_breaker_state.toUpperCase(),n-i,l)),a.envoy_proxy&&(r.fillStyle=o.proxy,r.fillText("⊡",n-i*2,l)),g==="detailed"||a.name===_){let c=0,x="",t="";switch(M){case"latency":c=a.response_time,x="ms",t="LAT";break;case"requests":c=a.request_rate,x="/s",t="RPS";break;case"errors":c=a.error_rate,x="%",t="ERR";break;case"cpu":c=a.cpu_usage,x="%",t="CPU";break}const d=8,y=c/(M==="latency"?500:M==="requests"?1e3:100),k=Math.floor(y*d);if(r.fillStyle=o.text+"40",r.fillText("█".repeat(d),n,l+i),k>0){let F=o.healthy;M==="errors"?F=y>.1?o.unhealthy:y>.05?o.degraded:o.healthy:F=y>.8?o.unhealthy:y>.6?o.degraded:o.healthy,r.fillStyle=F,r.fillText("█".repeat(k),n,l+i)}r.fillStyle=o.text,r.fillText(`${t}: ${c.toFixed(0)}${x}`,n+(d+1)*i,l+i)}r.fillStyle=o.text+"60",r.fillText(`[${a.namespace}]`,n,l+i*2)},S=(a,i)=>{const n=a.x*i,l=a.y*i,o=$[v];r.fillStyle=o.gateway;const h=a.type==="ingress"?"🔽":a.type==="egress"?"🔼":"🔄";r.fillText(h,n,l),r.fillStyle=o.text,r.fillText(a.name,n+i,l),a.ssl_enabled&&(r.fillStyle=o.healthy,r.fillText("🔒",n+i*15,l)),r.fillStyle=o.text,r.fillText(`${a.requests_per_second.toFixed(0)} req/s`,n,l+i)},re=a=>{if(!D)return;const i=j.current,n=$[v];A.current.forEach(l=>{const o=i.get(l.from_service),h=i.get(l.to_service);if(!o||!h)return;const f=o.x*a,c=o.y*a,x=h.x*a,t=h.y*a,d=W(f,x,l.progress),m=W(c,t,l.progress);let y=n.request;l.status_code>=400?y=n.unhealthy:l.status_code>=300&&(y=n.degraded),l.retry_attempt>0&&L&&(y=n.degraded,r.fillStyle=n.text+"80",r.fillText(`R${l.retry_attempt}`,d+a,m-a)),r.fillStyle=y,r.fillText("●",d,m),r.strokeStyle=y+"30",r.lineWidth=1,r.setLineDash([2,3]),r.beginPath(),r.moveTo(f,c),r.lineTo(x,t),r.stroke(),r.setLineDash([]),g==="detailed"&&(r.fillStyle=n.text+"60",r.fillText(`${l.method}`,d,m+a),r.fillText(`${l.latency.toFixed(0)}ms`,d,m+a*2))})},ae=a=>{const i=j.current,n=$[v];i.forEach(l=>{l.dependencies.forEach(o=>{const h=Array.from(i.values()).find(d=>d.name===o);if(!h)return;const f=l.x*a,c=l.y*a,x=h.x*a,t=h.y*a;r.strokeStyle=n.mesh+"50",r.lineWidth=1,r.setLineDash([5,5]),r.beginPath(),r.moveTo(f,c),r.lineTo(x,t),r.stroke(),r.setLineDash([])})})},G=()=>{if(!T)return;const a=$[v],i=11;r.fillStyle=a.bg,r.fillRect(0,0,s.width,s.height),r.font='11px "Courier New", monospace',r.textBaseline="top",Math.random()<.1*w&&V(),g==="topology"&&ae(i),I.current.forEach(c=>{S(c,i)}),j.current.forEach(c=>{g==="service"&&c.name!==_||E(c,i)}),re(i);const n=U.current,l=Array.from(j.current.values()),o=l.filter(c=>c.status==="healthy").length,h=l.filter(c=>c.status==="degraded").length,f=l.filter(c=>c.status==="unhealthy").length;if(r.fillStyle=a.text,r.fillText(`Service Mesh Dashboard - ${b.toUpperCase()} - ${g.toUpperCase()} VIEW`,10,s.height-140),r.fillText(`Services: ${o} Healthy | ${h} Degraded | ${f} Unhealthy | Total: ${l.length}`,10,s.height-125),r.fillText(`Success Rate: ${n.success_rate.toFixed(1)}% | Avg Latency: ${n.avg_latency.toFixed(0)}ms | P99: ${n.p99_latency.toFixed(0)}ms`,10,s.height-110),r.fillText(`Active Requests: ${n.active_connections} | Circuit Breakers Open: ${n.circuit_breakers_open}`,10,s.height-95),r.fillText(`Total RPS: ${n.total_requests.toFixed(0)} | mTLS: ${n.mtls_enabled?"Enabled":"Disabled"} | Traffic: ${C}`,10,s.height-80),r.fillText(`Mesh: ${b} | Display: ${M} | Fault Injection: ${N}`,10,s.height-65),g==="service"){const c=Array.from(j.current.values()).find(x=>x.name===_);c&&r.fillText(`Viewing: ${c.name} | Status: ${c.status} | Circuit Breaker: ${c.circuit_breaker_state}`,10,s.height-50)}P.current=requestAnimationFrame(G)};return q(),window.addEventListener("resize",q),T&&G(),()=>{window.removeEventListener("resize",q),P.current&&cancelAnimationFrame(P.current)}},[T,w,g,_,M,D,L,v,b,C,N]),e.jsxs("div",{className:"flex flex-col h-screen bg-black",children:[e.jsxs("div",{className:"flex-shrink-0 bg-gray-900 p-4 border-b border-gray-700",children:[e.jsx("h1",{className:"text-2xl font-bold text-purple-400 mb-4",children:"🕸️ ASCII Service Mesh Monitor"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-8 gap-4 text-sm mb-4",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-purple-300 mb-2",children:"Animation"}),e.jsx("button",{onClick:()=>O(!T),className:`px-3 py-2 rounded font-medium transition-colors ${T?"bg-red-600 hover:bg-red-700 text-white":"bg-green-600 hover:bg-green-700 text-white"}`,children:T?"Pause":"Play"})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("label",{className:"text-purple-300 mb-2",children:["Speed: ",w.toFixed(1),"x"]}),e.jsx("input",{type:"range",min:"0.1",max:"3",step:"0.1",value:w,onChange:s=>H(Number.parseFloat(s.target.value)),className:"w-full"})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-purple-300 mb-2",children:"View Mode"}),e.jsxs("select",{value:g,onChange:s=>J(s.target.value),className:"px-2 py-1 bg-gray-800 text-purple-300 rounded border border-gray-600",children:[e.jsx("option",{value:"topology",children:"Service Topology"}),e.jsx("option",{value:"service",children:"Single Service"}),e.jsx("option",{value:"detailed",children:"Detailed View"})]})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-purple-300 mb-2",children:"Selected Service"}),e.jsxs("select",{value:_,onChange:s=>K(s.target.value),className:"px-2 py-1 bg-gray-800 text-purple-300 rounded border border-gray-600",children:[e.jsx("option",{value:"user-service",children:"User Service"}),e.jsx("option",{value:"auth-service",children:"Auth Service"}),e.jsx("option",{value:"order-service",children:"Order Service"}),e.jsx("option",{value:"payment-service",children:"Payment Service"}),e.jsx("option",{value:"notification-service",children:"Notification Service"}),e.jsx("option",{value:"api-gateway",children:"API Gateway"})]})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-purple-300 mb-2",children:"Display Metric"}),e.jsxs("select",{value:M,onChange:s=>Q(s.target.value),className:"px-2 py-1 bg-gray-800 text-purple-300 rounded border border-gray-600",children:[e.jsx("option",{value:"latency",children:"Response Time"}),e.jsx("option",{value:"requests",children:"Request Rate"}),e.jsx("option",{value:"errors",children:"Error Rate"}),e.jsx("option",{value:"cpu",children:"CPU Usage"})]})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-purple-300 mb-2",children:"Mesh Type"}),e.jsxs("select",{value:b,onChange:s=>z(s.target.value),className:"px-2 py-1 bg-gray-800 text-purple-300 rounded border border-gray-600",children:[e.jsx("option",{value:"istio",children:"Istio"}),e.jsx("option",{value:"linkerd",children:"Linkerd"}),e.jsx("option",{value:"consul",children:"Consul Connect"})]})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-purple-300 mb-2",children:"Color Scheme"}),e.jsxs("select",{value:v,onChange:s=>Z(s.target.value),className:"px-2 py-1 bg-gray-800 text-purple-300 rounded border border-gray-600",children:[e.jsx("option",{value:"istio",children:"Istio Blue"}),e.jsx("option",{value:"linkerd",children:"Linkerd Pink"}),e.jsx("option",{value:"consul",children:"Consul Purple"})]})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("label",{className:"flex items-center text-purple-300 text-xs",children:[e.jsx("input",{type:"checkbox",checked:D,onChange:s=>X(s.target.checked),className:"mr-1"}),"Distributed Tracing"]}),e.jsxs("label",{className:"flex items-center text-purple-300 text-xs",children:[e.jsx("input",{type:"checkbox",checked:L,onChange:s=>Y(s.target.checked),className:"mr-1"}),"Retry Attempts"]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm mb-4",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-purple-300 mb-2",children:"Traffic Pattern"}),e.jsxs("select",{value:C,onChange:s=>ee(s.target.value),className:"px-2 py-1 bg-gray-800 text-purple-300 rounded border border-gray-600",children:[e.jsx("option",{value:"normal",children:"Normal Traffic"}),e.jsx("option",{value:"spike",children:"Traffic Spike"}),e.jsx("option",{value:"gradual-increase",children:"Gradual Increase"}),e.jsx("option",{value:"random-bursts",children:"Random Bursts"})]})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-purple-300 mb-2",children:"Fault Injection"}),e.jsxs("select",{value:N,onChange:s=>te(s.target.value),className:"px-2 py-1 bg-gray-800 text-purple-300 rounded border border-gray-600",children:[e.jsx("option",{value:"none",children:"No Faults"}),e.jsx("option",{value:"latency",children:"Inject Latency"}),e.jsx("option",{value:"errors",children:"Inject Errors"}),e.jsx("option",{value:"circuit-breaker",children:"Trigger Circuit Breaker"})]})]})]}),e.jsxs("div",{className:"mt-4 text-purple-400 text-sm",children:[e.jsxs("p",{children:["🕸️ ",e.jsx("strong",{children:"Service mesh monitoring"})," with real-time microservice communication and observability!"]}),e.jsxs("p",{children:["🔍 ",e.jsx("strong",{children:"Distributed tracing"})," with request flows, circuit breakers, and retry patterns!"]}),e.jsxs("p",{children:["⚡ ",e.jsx("strong",{children:"Fault injection testing"})," with latency, error rate, and circuit breaker simulation!"]}),e.jsx("p",{children:"Monitor Istio/Linkerd/Consul service mesh with ingress/egress gateways, mTLS, and traffic management"})]})]}),e.jsx("div",{className:"flex-1 relative",children:e.jsx("canvas",{ref:B,className:"absolute inset-0 w-full h-full",style:{background:$[v].bg}})})]})};export{le as component};
