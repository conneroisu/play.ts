import{r as u,j as i,l as x,s as X}from"./index-BqTI3VMm.js";const K=function(){const v=u.useRef(null),R=u.useRef(),T=u.useRef(!1),c=u.useRef(0),[y,b]=u.useState(!1),a=u.useRef([{id:"inst-1",status:"running",cpu:20,memory:30,requests:0,uptime:100,zone:"us-east-1a",x:10,y:8},{id:"inst-2",status:"running",cpu:25,memory:35,requests:0,uptime:98,zone:"us-east-1b",x:30,y:8}]),d=u.useRef({totalRequests:0,requestsPerSecond:0,activeConnections:0,responseTime:50}),C=u.useRef({targetCPU:70,currentCPU:0,desiredReplicas:2,currentReplicas:2,minReplicas:2,maxReplicas:10}),p=u.useRef([]),[m,U]=u.useState({totalInstances:2,runningInstances:2,avgCPU:0,totalRequests:0,responseTime:50}),I=e=>{const s=`inst-${Math.random().toString(36).substr(2,4)}`,l=a.current,n=10+l.length%8*10,t=8+Math.floor(l.length/8)*6;return{id:s,status:"starting",cpu:0,memory:0,requests:0,uptime:0,zone:e,x:n,y:t}},A=e=>{const s=50+X(e*.1)*30;let l=1;return Math.random()<.005&&p.current.push({time:e,spike:!0}),p.current=p.current.filter(n=>{const t=e-n.time;return t<10?(l*=1+2*Math.exp(-t),!0):!1}),s*l},w=e=>{const s=d.current,l=c.current,n=A(l);s.requestsPerSecond=x(s.requestsPerSecond,n,.1),s.totalRequests+=s.requestsPerSecond*e,s.activeConnections=Math.floor(s.requestsPerSecond*2+Math.random()*10);const t=a.current.filter(r=>r.status==="running");if(t.length>0){const r=t.reduce((S,g)=>S+g.cpu,0)/t.length,o=50,f=Math.max(1,r/70);s.responseTime=x(s.responseTime,o*f,.1)}},$=(e,s)=>{const l=d.current;if(e.status==="starting"){e.uptime+=s,e.uptime>3&&(e.status="running");return}if(e.status==="stopping"){e.uptime+=s,e.uptime>2&&(e.status="stopped");return}if(e.status==="running"){e.uptime+=s;const n=a.current.filter(t=>t.status==="running");if(n.length>0){const t=l.requestsPerSecond/n.length;e.requests=t;const r=Math.min(95,t*2+Math.random()*10);e.cpu=x(e.cpu,r,.05);const o=40+e.cpu/100*40+Math.random()*10;e.memory=x(e.memory,o,.03)}}},E=()=>{const e=a.current,s=C.current,l=e.filter(n=>n.status==="running");if(s.currentReplicas=e.filter(n=>n.status!=="stopped").length,l.length>0&&(s.currentCPU=l.reduce((n,t)=>n+t.cpu,0)/l.length),s.currentCPU>s.targetCPU+10&&s.currentReplicas<s.maxReplicas?s.desiredReplicas=Math.min(s.maxReplicas,s.currentReplicas+1):s.currentCPU<s.targetCPU-20&&s.currentReplicas>s.minReplicas&&(s.desiredReplicas=Math.max(s.minReplicas,s.currentReplicas-1)),s.desiredReplicas>s.currentReplicas){const n=["us-east-1a","us-east-1b","us-east-1c"],t=n[Math.floor(Math.random()*n.length)];e.push(I(t))}else if(s.desiredReplicas<s.currentReplicas){const n=l[l.length-1];n&&(n.status="stopping",n.uptime=0)}},k=(e,s,l,n)=>{const t=s.x,r=s.y;let o="#00ff00",f="●";switch(s.status){case"starting":o="#ffff00",f="◯";break;case"running":o=s.cpu>80?"#ff8800":"#00ff00",f="●";break;case"stopping":o="#ff8800",f="◐";break;case"stopped":o="#666666",f="○";break}e.fillStyle=o,e.fillText("╭────────────╮",t*l,r*n),e.fillText("│",t*l,(r+1)*n),e.fillText("│",(t+13)*l,(r+1)*n),e.fillStyle="#ffffff",e.fillText(`${s.id}`,(t+2)*l,(r+1)*n),e.fillStyle=o,e.fillText(f,(t+11)*l,(r+1)*n),e.fillText("│",t*l,(r+2)*n),e.fillText("│",(t+13)*l,(r+2)*n),e.fillStyle="#ffffff",e.fillText(`CPU:${s.cpu.toFixed(0)}%`,(t+2)*l,(r+2)*n),e.fillStyle=o,e.fillText("│",t*l,(r+3)*n),e.fillText("│",(t+13)*l,(r+3)*n),e.fillStyle="#ffffff",e.fillText(`MEM:${s.memory.toFixed(0)}%`,(t+2)*l,(r+3)*n),e.fillStyle=o,e.fillText("│",t*l,(r+4)*n),e.fillText("│",(t+13)*l,(r+4)*n),e.fillStyle="#ffffff",e.fillText(`RPS:${s.requests.toFixed(0)}`,(t+2)*l,(r+4)*n),e.fillStyle=o,e.fillText("╰────────────╯",t*l,(r+5)*n),e.fillStyle="#666666",e.fillText(s.zone.slice(-2),(t+5)*l,(r+6)*n)},L=(e,s,l)=>{const n=d.current,t=35,r=3;e.fillStyle="#00ffff",e.fillText("╭─── LOAD BALANCER ───╮",t*s,r*l),e.fillText("│",t*s,(r+1)*l),e.fillText("│",(t+20)*s,(r+1)*l),e.fillStyle="#ffffff",e.fillText(`RPS: ${n.requestsPerSecond.toFixed(0)}`,(t+2)*s,(r+1)*l),e.fillText(`RT: ${n.responseTime.toFixed(0)}ms`,(t+12)*s,(r+1)*l),e.fillStyle="#00ffff",e.fillText("│",t*s,(r+2)*l),e.fillText("│",(t+20)*s,(r+2)*l),e.fillStyle="#ffffff",e.fillText(`Connections: ${n.activeConnections}`,(t+2)*s,(r+2)*l),e.fillStyle="#00ffff",e.fillText("╰─────────────────────╯",t*s,(r+3)*l),a.current.filter(f=>f.status==="running").forEach((f,S)=>{if(Math.random()<.3){const g=r+4,M=t+10+(Math.random()-.5)*4,B=f.x+6,D=f.y-1,q=(c.current*3+S)%1,O=M+(B-M)*q,G=g+(D-g)*q;e.fillStyle="#ffff00",e.fillText("→",O*s,G*l)}})},F=(e,s,l)=>{const n=C.current,t=5,r=20;e.fillStyle="#ffffff",e.fillText("AUTOSCALING CONTROLLER",t*s,r*l),e.fillText("──────────────────────",t*s,(r+1)*l),e.fillStyle="#888888",e.fillText(`Target CPU: ${n.targetCPU}%`,t*s,(r+2)*l),e.fillText(`Current CPU: ${n.currentCPU.toFixed(1)}%`,t*s,(r+3)*l),e.fillText(`Min/Max Replicas: ${n.minReplicas}/${n.maxReplicas}`,t*s,(r+4)*l);const o=n.desiredReplicas!==n.currentReplicas?"#ffff00":"#00ff00";e.fillStyle=o,e.fillText(`Current/Desired: ${n.currentReplicas}/${n.desiredReplicas}`,t*s,(r+5)*l),n.desiredReplicas>n.currentReplicas?(e.fillStyle="#00ff00",e.fillText("▲ SCALING UP",(t+25)*s,(r+2)*l)):n.desiredReplicas<n.currentReplicas?(e.fillStyle="#ff8800",e.fillText("▼ SCALING DOWN",(t+25)*s,(r+2)*l)):(e.fillStyle="#888888",e.fillText("● STABLE",(t+25)*s,(r+2)*l))},z=(e,s,l)=>{p.current.forEach(n=>{const t=c.current-n.time;if(t<5){const r=1-t/5,o=60+Math.random()*10,f=2+Math.random()*3;r>.5&&(e.fillStyle="#ff0000",e.fillText("⚡",o*s,f*l))}})},j=()=>{if(!T.current)return;const e=v.current;if(!e)return;const s=e.getContext("2d");if(!s)return;c.current+=.016,s.fillStyle="#000000",s.fillRect(0,0,e.width,e.height);const l=8,n=16;s.font="12px monospace",s.fillStyle="#ffffff",s.fillText("Cloud Auto-scaling Dashboard",10,20),s.fillText("════════════════════════════════════════════════════════════════",10,35),w(.016),a.current.forEach(o=>$(o,.016)),Math.floor(c.current*10)%10===0&&E(),a.current=a.current.filter(o=>o.status!=="stopped"),a.current.forEach((o,f)=>{o.x=10+f%8*10,o.y=8+Math.floor(f/8)*6}),L(s,l,n),a.current.forEach(o=>k(s,o,l,n)),F(s,l,n),z(s,l,n);const t=a.current.filter(o=>o.status==="running"),r=t.length>0?t.reduce((o,f)=>o+f.cpu,0)/t.length:0;U({totalInstances:a.current.length,runningInstances:t.length,avgCPU:r,totalRequests:Math.floor(d.current.totalRequests),responseTime:Math.floor(d.current.responseTime)}),R.current=requestAnimationFrame(j)},N=()=>{b(!0),T.current=!0,j()},P=()=>{b(!1),T.current=!1,R.current&&cancelAnimationFrame(R.current)};return u.useEffect(()=>(N(),()=>P()),[]),i.jsxs("div",{className:"p-6 max-w-6xl mx-auto",children:[i.jsxs("div",{className:"mb-6",children:[i.jsx("h1",{className:"text-3xl font-bold mb-2",children:"Cloud Auto-scaling"}),i.jsx("p",{className:"text-gray-600",children:"Real-time visualization of cloud auto-scaling in action, showing load balancer traffic, instance scaling based on CPU utilization, and traffic spike handling."})]}),i.jsxs("div",{className:"mb-4 grid grid-cols-2 md:grid-cols-5 gap-4",children:[i.jsxs("div",{className:"bg-blue-100 p-3 rounded",children:[i.jsx("div",{className:"text-sm text-gray-600",children:"Running Instances"}),i.jsx("div",{className:"text-2xl font-bold text-blue-600",children:m.runningInstances})]}),i.jsxs("div",{className:"bg-green-100 p-3 rounded",children:[i.jsx("div",{className:"text-sm text-gray-600",children:"Avg CPU"}),i.jsxs("div",{className:"text-2xl font-bold text-green-600",children:[m.avgCPU.toFixed(0),"%"]})]}),i.jsxs("div",{className:"bg-purple-100 p-3 rounded",children:[i.jsx("div",{className:"text-sm text-gray-600",children:"Total Requests"}),i.jsx("div",{className:"text-2xl font-bold text-purple-600",children:m.totalRequests})]}),i.jsxs("div",{className:"bg-yellow-100 p-3 rounded",children:[i.jsx("div",{className:"text-sm text-gray-600",children:"Response Time"}),i.jsxs("div",{className:"text-2xl font-bold text-yellow-600",children:[m.responseTime,"ms"]})]}),i.jsxs("div",{className:"bg-gray-100 p-3 rounded",children:[i.jsx("div",{className:"text-sm text-gray-600",children:"Total Instances"}),i.jsx("div",{className:"text-2xl font-bold",children:m.totalInstances})]})]}),i.jsx("div",{className:"mb-4",children:i.jsxs("button",{onClick:y?P:N,className:`px-4 py-2 rounded ${y?"bg-red-500 hover:bg-red-600 text-white":"bg-green-500 hover:bg-green-600 text-white"}`,children:[y?"Stop":"Start"," Auto-scaling"]})}),i.jsx("div",{className:"border rounded-lg p-4 bg-black",children:i.jsx("canvas",{ref:v,width:800,height:600,className:"block",style:{width:"100%",height:"auto",maxWidth:"100%",imageRendering:"pixelated"}})}),i.jsxs("div",{className:"mt-4 text-sm text-gray-600",children:[i.jsx("h3",{className:"font-semibold mb-2",children:"Legend:"}),i.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[i.jsx("div",{children:"◯ Starting instance"}),i.jsx("div",{children:"● Running instance"}),i.jsx("div",{children:"◐ Stopping instance"}),i.jsx("div",{children:"→ Traffic flow"}),i.jsx("div",{children:"⚡ Traffic spike"}),i.jsx("div",{children:"▲/▼ Scaling events"})]})]})]})};export{K as component};
