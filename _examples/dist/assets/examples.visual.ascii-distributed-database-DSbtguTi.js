import{r as h,j as t,e as V,l as X}from"./index-BqTI3VMm.js";const le=function(){const W=h.useRef(null),B=h.useRef(0),j=h.useRef(new Map),T=h.useRef([]),D=h.useRef([]),[S,H]=h.useState(!0),[_,Y]=h.useState(1),[N,G]=h.useState("performance"),[A,O]=h.useState("cluster"),[F,J]=h.useState("us-east"),[k,K]=h.useState("eventual"),[C,Z]=h.useState("normal"),[w,z]=h.useState("database"),[q,ee]=h.useState(!0),[Q,te]=h.useState(!0),[U,ae]=h.useState(.8),R={database:{bg:"#001122",primary:"#00AA44",replica:"#0088AA",shard:"#AA8800",coordinator:"#AA44AA",offline:"#AA0000",text:"#FFFFFF",transaction:"#00AAFF"},mongodb:{bg:"#001100",primary:"#00AA00",replica:"#006600",shard:"#888800",coordinator:"#AA4400",offline:"#AA0000",text:"#FFFFFF",transaction:"#44AA44"},cassandra:{bg:"#110022",primary:"#8844AA",replica:"#6622AA",shard:"#AA4488",coordinator:"#AA8844",offline:"#AA0000",text:"#FFFFFF",transaction:"#AA44AA"},postgresql:{bg:"#002244",primary:"#4488CC",replica:"#2266AA",shard:"#6688AA",coordinator:"#88AACC",offline:"#AA0000",text:"#FFFFFF",transaction:"#44AACC"},redis:{bg:"#220000",primary:"#CC4444",replica:"#AA2222",shard:"#884444",coordinator:"#AA6644",offline:"#440000",text:"#FFFFFF",transaction:"#CC6644"}};return h.useEffect(()=>{const l=new Map,a=["us-east","us-west","eu-west","asia-pacific"];let M=0;a.forEach((m,P)=>{const $=5+P*30,I=`${m}-primary`,L={id:I,name:`${m}-primary`,type:"primary",region:m,status:"healthy",connections:Math.floor(Math.random()*100)+20,queries_per_sec:Math.floor(Math.random()*1e3)+100,replication_lag:Math.random()*50,storage_used:Math.random()*80+10,storage_total:1e3,cpu_usage:Math.random()*60+10,memory_usage:Math.random()*70+15,x:$,y:3,data_shards:[`shard-${M}`],is_leader:P===0,last_heartbeat:Date.now(),consistency_level:"strong",partition_key:`region:${m}`,backup_status:"current"};l.set(I,L),M++;for(let r=0;r<2;r++){const e=`${m}-replica-${r+1}`,i={id:e,name:`${m}-replica-${r+1}`,type:"replica",region:m,status:"healthy",connections:Math.floor(Math.random()*50)+10,queries_per_sec:Math.floor(Math.random()*500)+50,replication_lag:Math.random()*100+10,storage_used:Math.random()*80+10,storage_total:1e3,cpu_usage:Math.random()*40+5,memory_usage:Math.random()*60+10,x:$,y:8+r*4,data_shards:[`shard-${M}`],is_leader:!1,last_heartbeat:Date.now(),consistency_level:"eventual",partition_key:`region:${m}`,backup_status:"current"};l.set(e,i),M++}const E=`${m}-shard`,s={id:E,name:`${m}-shard`,type:"shard",region:m,status:"healthy",connections:Math.floor(Math.random()*30)+5,queries_per_sec:Math.floor(Math.random()*300)+20,replication_lag:Math.random()*20,storage_used:Math.random()*90+5,storage_total:500,cpu_usage:Math.random()*70+10,memory_usage:Math.random()*80+10,x:$,y:17,data_shards:[`shard-${M}`],is_leader:!1,last_heartbeat:Date.now(),consistency_level:"eventual",partition_key:`shard:${P}`,backup_status:"current"};l.set(E,s)}),j.current=l},[]),h.useEffect(()=>{const l=W.current;if(!l)return;const a=l.getContext("2d");if(!a)return;const M=()=>{l.width=l.offsetWidth,l.height=l.offsetHeight},m=()=>{const s=j.current,r=Date.now()/1e3;if(s.forEach(e=>{let i=1;if(C==="high-traffic"?(i=2,e.queries_per_sec=Math.min(5e3,e.queries_per_sec*1.5),e.cpu_usage=Math.min(95,e.cpu_usage*1.3)):C==="partition"?e.region==="asia-pacific"&&(e.status="offline",e.replication_lag=9999,e.last_heartbeat=Date.now()-3e4):C==="split-brain"?e.type==="primary"&&e.region!=="us-east"&&(e.status="split-brain",e.is_leader=!0):C==="backup-failure"&&Math.random()<.3&&(e.backup_status="failed"),e.status!=="offline"){const o=e.type==="primary"?60:e.type==="coordinator"?40:30,u=15*Math.sin(r*.5+Math.random())+Math.random()*10;e.queries_per_sec=Math.max(0,o+u)*i,e.cpu_usage=V(e.cpu_usage+(Math.random()-.5)*5,5,95),e.memory_usage=V(e.memory_usage+(Math.random()-.5)*3,10,90),e.connections=Math.max(0,e.connections+Math.floor((Math.random()-.5)*5)),e.type==="replica"&&(e.replication_lag=Math.max(0,e.replication_lag+(Math.random()-.7)*10),e.replication_lag>1e3?e.status="lagging":e.replication_lag>100?e.status="syncing":e.status="healthy"),e.storage_used=Math.min(e.storage_total*.95,e.storage_used+Math.random()*.1),e.last_heartbeat=Date.now()}k==="strong"?(e.type==="primary"||e.type==="coordinator")&&(e.consistency_level="strong"):k==="eventual"&&(e.consistency_level="eventual")}),Math.random()<.15*_&&q){const e=Array.from(s.values()).filter(i=>i.status!=="offline");if(e.length>=2){const i=e[Math.floor(Math.random()*e.length)];let o=e[Math.floor(Math.random()*e.length)];for(;o.id===i.id&&e.length>1;)o=e[Math.floor(Math.random()*e.length)];const u=["read","write","replication","backup","migration"],f=u[Math.floor(Math.random()*u.length)];T.current.push({id:`tx-${i.id}-${o.id}-${Date.now()}`,type:f,from_node:i.id,to_node:o.id,progress:0,size:Math.random()*1e3+100,consistency:Math.random()<.3?"strong":"eventual",timestamp:Date.now(),success_rate:.95+Math.random()*.05})}}if(T.current=T.current.filter(e=>(e.progress+=.02*_,Math.random()>e.success_rate?!1:e.progress<1)),Math.random()<.05*_){const e=Array.from(s.values()).filter(i=>i.region===F&&i.status==="healthy");if(e.length>=2){const i=e.slice(0,Math.min(3,e.length));D.current.push({id:`check-${Date.now()}`,nodes:i.map(o=>o.id),status:"checking",conflicts:Math.floor(Math.random()*5),resolution_time:Math.random()*2e3+500})}}D.current=D.current.map(e=>(e.status==="checking"?(e.resolution_time-=100*_,e.resolution_time<=0&&(e.status=e.conflicts>0?"inconsistent":"consistent",e.status==="inconsistent"&&(e.status="resolving",e.resolution_time=1e3))):e.status==="resolving"&&(e.resolution_time-=100*_,e.resolution_time<=0&&(e.status="consistent",e.conflicts=0)),e)).filter(e=>e.status!=="consistent"||Date.now()-e.resolution_time<2e3)},P=(s,r)=>{if(s.status==="offline"||s.status==="split-brain")return r.offline;if(s.status==="lagging")return r.transaction;switch(s.type){case"primary":return r.primary;case"replica":return r.replica;case"shard":return r.shard;case"coordinator":return r.coordinator;case"cache":return r.replica;default:return r.text}},$=(s,r)=>{const e=s.x*r,i=s.y*r,o=R[w];let u="██",f="";s.type==="primary"?(u="██",f="PRI"):s.type==="replica"?(u="▓▓",f="REP"):s.type==="shard"?(u="▒▒",f="SHD"):s.type==="coordinator"&&(u="◉◉",f="CRD"),a.fillStyle=P(s,o),a.fillText(u,e,i),s.is_leader&&(a.fillStyle="#FFD700",a.fillText("★",e-r*2,i)),s.status==="split-brain"?(a.fillStyle=o.offline,a.fillText("⚠️",e+r*3,i)):s.status==="lagging"?(a.fillStyle=o.transaction,a.fillText("⏳",e+r*3,i)):s.backup_status==="failed"&&(a.fillStyle=o.offline,a.fillText("❌",e+r*3,i)),a.fillStyle=o.text;const x=s.region.split("-")[0].toUpperCase()+"-"+f;a.fillText(x,e,i+r*1.5),a.fillStyle=o.text+"CC",a.fillText(s.region,e,i-r*.5);let d=0,n="";switch(N){case"performance":d=s.queries_per_sec,n=" QPS";break;case"storage":d=s.storage_used/s.storage_total*100,n="%";break;case"replication":d=s.replication_lag,n="ms";break;case"cpu":d=s.cpu_usage,n="%";break;case"memory":d=s.memory_usage,n="%";break;case"connections":d=s.connections,n="";break}const c=6,g=Math.min(1,d/(N==="performance"?2e3:N==="replication"?500:N==="connections"?200:100)),v=Math.floor(g*c);if(a.fillStyle=o.text+"40",a.fillText("░".repeat(c),e,i+r*2.5),v>0){let y=o.primary;N==="replication"&&d>100?y=o.offline:g>.8&&(y=o.transaction),a.fillStyle=y,a.fillText("█".repeat(v),e,i+r*2.5)}a.fillStyle=o.text,a.fillText(`${d.toFixed(0)}${n}`,e,i+r*3.5)},I=s=>{if(!q)return;const r=j.current,e=R[w];T.current.forEach(i=>{const o=r.get(i.from_node),u=r.get(i.to_node);if(!o||!u)return;const f=o.x*s,x=o.y*s,d=u.x*s,n=u.y*s,c=X(f,d,i.progress),b=X(x,n,i.progress);let g=e.transaction;i.type==="write"?g=e.primary:i.type==="replication"?g=e.replica:i.type==="backup"&&(g=e.shard),a.fillStyle=g,a.fillText("●",c,b),Q&&i.type==="replication"&&(a.strokeStyle=g+"40",a.lineWidth=1,a.setLineDash([2,3]),a.beginPath(),a.moveTo(f,x),a.lineTo(d,n),a.stroke(),a.setLineDash([]))})},L=(s,r)=>{const e=Array.from(j.current.values()).filter(p=>p.region===s);if(e.length===0)return;const i=Math.min(...e.map(p=>p.x)),o=Math.max(...e.map(p=>p.x)),u=Math.min(...e.map(p=>p.y)),f=Math.max(...e.map(p=>p.y)),x=(i-2)*r,d=(u-2)*r,n=(o-i+8)*r,c=(f-u+8)*r,b=R[w];a.strokeStyle=b.text+"AA",a.lineWidth=2,a.strokeRect(x,d,n,c),a.fillStyle=b.text,a.font='bold 14px "Courier New", monospace',a.fillText(s.toUpperCase(),x+4,d-4),a.font='14px "Courier New", monospace';const g=e.filter(p=>p.status==="healthy").length,v=e.length,y=e.reduce((p,se)=>p+se.queries_per_sec,0)/v;a.fillStyle=g===v?b.primary:b.transaction,a.fillText(`${g}/${v} UP`,x+4,d+c-20),a.fillStyle=b.text,a.fillText(`${y.toFixed(0)} QPS`,x+4,d+c-5)},E=()=>{if(!S)return;const s=R[w],r=14;a.fillStyle=s.bg,a.fillRect(0,0,l.width,l.height),a.font='14px "Courier New", monospace',a.textBaseline="top",Math.random()<.1*_&&m(),A==="cluster"?(["us-east","us-west","eu-west","asia-pacific"].forEach(n=>{L(n,r)}),j.current.forEach(n=>{$(n,r)})):A==="region"&&(L(F,r),Array.from(j.current.values()).filter(c=>c.region===F).forEach(c=>{$(c,r)})),I(r),D.current.forEach(n=>{const c=n.nodes.map(y=>j.current.get(y)).filter(Boolean);if(c.length===0)return;const b=c.reduce((y,p)=>y+p.x,0)/c.length*r,g=c.reduce((y,p)=>y+p.y,0)/c.length*r;let v=s.primary;n.status==="inconsistent"?v=s.offline:n.status==="resolving"&&(v=s.transaction),a.fillStyle=v,a.fillText("⚖",b,g)});const e=Array.from(j.current.values()),i=e.filter(n=>n.status==="healthy").length,o=e.filter(n=>n.status==="offline").length,u=e.reduce((n,c)=>n+c.queries_per_sec,0),f=e.filter(n=>n.type==="replica").reduce((n,c)=>n+c.replication_lag,0)/Math.max(1,e.filter(n=>n.type==="replica").length),x=T.current.length,d=D.current.filter(n=>n.status==="inconsistent").length;a.fillStyle=s.text,a.fillText(`Distributed Database Cluster - ${A.toUpperCase()} VIEW`,10,l.height-120),a.fillText(`Nodes: ${i} healthy | ${o} offline | Total: ${e.length}`,10,l.height-105),a.fillText(`Performance: ${u.toFixed(0)} total QPS | Avg replication lag: ${f.toFixed(0)}ms`,10,l.height-90),a.fillText(`Transactions: ${x} active | Consistency: ${k} | Issues: ${d}`,10,l.height-75),a.fillText(`Simulation: ${C} | Display: ${N} | Partition tolerance: ${(U*100).toFixed(0)}%`,10,l.height-60),A==="region"&&a.fillText(`Viewing region: ${F}`,10,l.height-45),B.current=requestAnimationFrame(E)};return M(),window.addEventListener("resize",M),S&&E(),()=>{window.removeEventListener("resize",M),B.current&&cancelAnimationFrame(B.current)}},[S,_,N,A,F,k,C,w,q,Q,U]),t.jsxs("div",{className:"flex flex-col h-screen bg-black",children:[t.jsxs("div",{className:"flex-shrink-0 bg-gray-900 p-4 border-b border-gray-700",children:[t.jsx("h1",{className:"text-2xl font-bold text-blue-400 mb-4",children:"🗄️ ASCII Distributed Database Monitor"}),t.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-8 gap-4 text-sm mb-4",children:[t.jsxs("div",{className:"flex flex-col",children:[t.jsx("label",{className:"text-blue-300 mb-2",children:"Animation"}),t.jsx("button",{onClick:()=>H(!S),className:`px-3 py-2 rounded font-medium transition-colors ${S?"bg-red-600 hover:bg-red-700 text-white":"bg-green-600 hover:bg-green-700 text-white"}`,children:S?"Pause":"Play"})]}),t.jsxs("div",{className:"flex flex-col",children:[t.jsxs("label",{className:"text-blue-300 mb-2",children:["Speed: ",_.toFixed(1),"x"]}),t.jsx("input",{type:"range",min:"0.1",max:"3",step:"0.1",value:_,onChange:l=>Y(Number.parseFloat(l.target.value)),className:"w-full"})]}),t.jsxs("div",{className:"flex flex-col",children:[t.jsx("label",{className:"text-blue-300 mb-2",children:"Display Mode"}),t.jsxs("select",{value:N,onChange:l=>G(l.target.value),className:"px-2 py-1 bg-gray-800 text-blue-300 rounded border border-gray-600",children:[t.jsx("option",{value:"performance",children:"Performance (QPS)"}),t.jsx("option",{value:"storage",children:"Storage Usage"}),t.jsx("option",{value:"replication",children:"Replication Lag"}),t.jsx("option",{value:"cpu",children:"CPU Usage"}),t.jsx("option",{value:"memory",children:"Memory Usage"}),t.jsx("option",{value:"connections",children:"Connections"})]})]}),t.jsxs("div",{className:"flex flex-col",children:[t.jsx("label",{className:"text-blue-300 mb-2",children:"View Mode"}),t.jsxs("select",{value:A,onChange:l=>O(l.target.value),className:"px-2 py-1 bg-gray-800 text-blue-300 rounded border border-gray-600",children:[t.jsx("option",{value:"cluster",children:"Full Cluster"}),t.jsx("option",{value:"region",children:"Single Region"})]})]}),t.jsxs("div",{className:"flex flex-col",children:[t.jsx("label",{className:"text-blue-300 mb-2",children:"Selected Region"}),t.jsxs("select",{value:F,onChange:l=>J(l.target.value),className:"px-2 py-1 bg-gray-800 text-blue-300 rounded border border-gray-600",disabled:A!=="region",children:[t.jsx("option",{value:"us-east",children:"US East"}),t.jsx("option",{value:"us-west",children:"US West"}),t.jsx("option",{value:"eu-west",children:"EU West"}),t.jsx("option",{value:"asia-pacific",children:"Asia Pacific"})]})]}),t.jsxs("div",{className:"flex flex-col",children:[t.jsx("label",{className:"text-blue-300 mb-2",children:"Consistency Mode"}),t.jsxs("select",{value:k,onChange:l=>K(l.target.value),className:"px-2 py-1 bg-gray-800 text-blue-300 rounded border border-gray-600",children:[t.jsx("option",{value:"strong",children:"Strong Consistency"}),t.jsx("option",{value:"eventual",children:"Eventual Consistency"}),t.jsx("option",{value:"weak",children:"Weak Consistency"})]})]}),t.jsxs("div",{className:"flex flex-col",children:[t.jsx("label",{className:"text-blue-300 mb-2",children:"Simulation Mode"}),t.jsxs("select",{value:C,onChange:l=>Z(l.target.value),className:"px-2 py-1 bg-gray-800 text-blue-300 rounded border border-gray-600",children:[t.jsx("option",{value:"normal",children:"Normal Operations"}),t.jsx("option",{value:"high-traffic",children:"High Traffic"}),t.jsx("option",{value:"partition",children:"Network Partition"}),t.jsx("option",{value:"split-brain",children:"Split Brain"}),t.jsx("option",{value:"backup-failure",children:"Backup Failure"})]})]}),t.jsxs("div",{className:"flex flex-col",children:[t.jsx("label",{className:"text-blue-300 mb-2",children:"Color Scheme"}),t.jsxs("select",{value:w,onChange:l=>z(l.target.value),className:"px-2 py-1 bg-gray-800 text-blue-300 rounded border border-gray-600",children:[t.jsx("option",{value:"database",children:"Generic DB"}),t.jsx("option",{value:"mongodb",children:"MongoDB"}),t.jsx("option",{value:"cassandra",children:"Cassandra"}),t.jsx("option",{value:"postgresql",children:"PostgreSQL"}),t.jsx("option",{value:"redis",children:"Redis"})]})]})]}),t.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm mb-4",children:[t.jsxs("div",{className:"flex flex-col",children:[t.jsxs("label",{className:"text-blue-300 mb-2",children:["Partition Tolerance: ",(U*100).toFixed(0),"%"]}),t.jsx("input",{type:"range",min:"0.1",max:"1",step:"0.1",value:U,onChange:l=>ae(Number.parseFloat(l.target.value)),className:"w-full"})]}),t.jsxs("div",{className:"flex flex-col gap-2",children:[t.jsxs("label",{className:"flex items-center text-blue-300 text-xs",children:[t.jsx("input",{type:"checkbox",checked:q,onChange:l=>ee(l.target.checked),className:"mr-1"}),"Transactions"]}),t.jsxs("label",{className:"flex items-center text-blue-300 text-xs",children:[t.jsx("input",{type:"checkbox",checked:Q,onChange:l=>te(l.target.checked),className:"mr-1"}),"Replication"]})]})]}),t.jsxs("div",{className:"mt-4 text-blue-400 text-sm",children:[t.jsxs("p",{children:["🗄️ ",t.jsx("strong",{children:"Distributed database cluster"})," with real-time consistency monitoring and CAP theorem simulation!"]}),t.jsxs("p",{children:["⚖️ ",t.jsx("strong",{children:"Consistency models"})," - Strong, eventual, and weak consistency with automatic conflict resolution!"]}),t.jsxs("p",{children:["🌐 ",t.jsx("strong",{children:"Multi-region architecture"})," with primary/replica/shard nodes, partitions, and split-brain scenarios!"]}),t.jsx("p",{children:"Monitor MongoDB, Cassandra, PostgreSQL, Redis clusters with replication lag, transactions, and backup status"})]})]}),t.jsx("div",{className:"flex-1 relative",children:t.jsx("canvas",{ref:W,className:"absolute inset-0 w-full h-full",style:{background:R[w].bg}})})]})};export{le as component};
